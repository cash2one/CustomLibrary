
#include <assert.h>
#include "general.h"
#include "Encrypt.h"
#include "Utils_c.h"
#include "ErrorTest.h"
#include "GeneralCall.h"
#ifdef __ANDROID__
#include <sys/time.h>
#include <unistd.h>
#include <time.h>
#endif


/*删除对象*/
bool test_deleteobject(CK_OBJECT_HANDLE hobj)
{
	CK_RV rv=0;

	printf("enter test_deleteobject.\n");

	rv = pC_DestroyObject(hSession,hobj);
	if(rv!=CKR_OK)
	{
		printf("test_deleteobject failed,pC_DestroyObject. rv=0x%08x.\n",rv);
		return FALSE;
	}	
	
	return TRUE;

}

void get_obj_attr(CK_SESSION_HANDLE hSession,CK_OBJECT_HANDLE hObj)
{
	CK_ULONG i=0;
	CK_RV rv=CKR_OK;
	CK_ATTRIBUTE template_get[] = {
		{CKA_LABEL, NULL, 0}
	};

	rv=pC_GetAttributeValue(hSession,hObj,template_get,sizeof(template_get)/sizeof(template_get[0]));
	if(rv!=CKR_OK)
	{
		printf(" pC_GetAttributeValue failed. rv=0x%x.\n",rv);
	}

	for(i=0;i<sizeof(template_get)/sizeof(template_get[0]);i++)
	{
		template_get[i].pValue=(CK_VOID_PTR)malloc(template_get[i].ulValueLen);
		if(template_get[i].pValue==NULL)
		{
			printf(" pC_GetAttributeValue memory out.\n");
		}
		memset(template_get[i].pValue,0,template_get[i].ulValueLen);
	}

	rv=pC_GetAttributeValue(hSession,hObj,template_get,sizeof(template_get)/sizeof(template_get[0]));
	if(rv!=CKR_OK)
	{
		printf(" pC_GetAttributeValue failed 2. rv=0x%x.\n",rv);
	}

	for(i=0;i<sizeof(template_get)/sizeof(template_get[0]);i++)
	{
		free(template_get[i].pValue);
	}
}

/*对象(创建、查找、删除)*/
bool test_objects()
{
	CK_RV rv=0;
	CK_OBJECT_HANDLE htempobject=0;
	CK_OBJECT_HANDLE hObject[16];
	CK_ULONG ulObjectCount=0,j=0;
	int i=0;
	CK_ULONG ulSize=0;
	
	CK_BBOOL         ttrue = CK_TRUE;
	CK_BBOOL         tfalse = CK_FALSE;

	CK_KEY_TYPE      RSAkeyType=CKK_RSA;
	CK_OBJECT_CLASS  RSApubclass=CKO_PUBLIC_KEY,RSApriclass=CKO_PRIVATE_KEY;
	CK_UINT         RSAmodulusBits = 1024;

	CK_BYTE     Modulus[128]={
		0xa2,0xfd,0x11,0x93,0xf5,0x72,0x1c,0x8c,0xa8,0xe8,0x59,0xf2,0x2b,0xfa,0x51,0x16,
			0x5b,0x91,0xd9,0x75,0xbb,0x2b,0x24,0x4d,0x77,0xa3,0xc8,0xee,0x18,0x76,0x41,0x0b, 
			0x77,0x32,0x10,0x6a,0xd7,0x52,0x0c,0x31,0x4a,0x5a,0x50,0xe7,0xd6,0xaf,0x86,0xf3,  
			0xf3,0x18,0x5a,0xdc,0xaf,0x06,0xad,0x3c,0x72,0x23,0x7e,0x10,0xd1,0x26,0x9e,0x27,  
			0x24,0xbe,0xe4,0x8c,0x1b,0x2a,0x31,0xfb,0x68,0x43,0x68,0x71,0x65,0xdf,0xa9,0x0e,  
			0x9c,0x30,0x15,0x78,0x7b,0x93,0x60,0x43,0xc9,0xbd,0xcc,0x14,0xc4,0xbe,0x19,0xa5,  
			0x50,0xf6,0x49,0xb7,0x73,0x3d,0xb8,0x45,0x75,0x39,0x08,0x2e,0x0c,0x7a,0x48,0x4d,  
			0x58,0x76,0x83,0x97,0xba,0x86,0xa4,0x48,0xe1,0xcd,0xd0,0x1d,0xa1,0x56,0x4a,0x35 
	};
	CK_BYTE     PublicExponent[4]={0x00,0x01,0x00,0x01};
	CK_BYTE     PrivateExponent[128]={
		0x23,0x25,0xfa,0x05,0x73,0x57,0xe1,0x6a,0x3f,0xfe,0xa3,0x6f,0x03,0x26,0xdf,0x17,  
			0xb8,0x35,0x92,0xb4,0xbd,0xe1,0x46,0xd9,0xe1,0xe4,0x13,0x2f,0xad,0x5c,0xcb,0x18,  
			0x22,0xe3,0x4c,0x01,0x0e,0x60,0x26,0x3a,0xf6,0xf2,0xd5,0x21,0xb9,0xfd,0x6e,0x57,  
			0xeb,0x63,0xa4,0x2c,0x95,0x1e,0x16,0x7b,0xc3,0x8d,0x7d,0xe1,0x38,0x89,0x60,0x6f,  
			0x6e,0x6d,0xe7,0x01,0x69,0x01,0x96,0x31,0x3c,0x7d,0xa9,0x09,0x4a,0xdd,0xdf,0xbc,  
			0x2c,0x24,0xc4,0x1d,0xc4,0x6a,0x14,0x80,0x01,0x75,0x4f,0x6c,0x52,0x1a,0xc5,0xfd,  
			0xb0,0x40,0x71,0x65,0xc2,0xbb,0x0e,0x8a,0x43,0x61,0x9a,0x9b,0x99,0x74,0x75,0xca,  
			0xb5,0x0f,0xac,0x83,0x5d,0xfc,0xee,0xf4,0xa6,0xda,0xf7,0x3c,0x51,0xe3,0xd5,0xfd  
	};
	CK_BYTE     Prime1[64]={
		0xd1,0xe4,0x30,0x53,0x0e,0xaa,0xcd,0xcf,0x7e,0x68,0x74,0x1b,0x0c,0x35,0x18,0xe2,  
			0x03,0xbb,0x05,0xdd,0x31,0xbc,0x76,0x49,0x6e,0xf8,0x3f,0x02,0x1e,0x1e,0x61,0x0e,  
			0x4a,0x4f,0x64,0x3b,0x1c,0xb0,0x73,0xcf,0x0c,0xe0,0x8b,0xfe,0x54,0xfe,0xa3,0x2b,  
			0xfa,0xc7,0x74,0x4b,0xd0,0x1f,0x7d,0x20,0x79,0xda,0xff,0x2c,0x1c,0x47,0x4e,0xd7  
	};
	CK_BYTE     Prime2[64]={
		0xc6,0xcb,0x2c,0x38,0x52,0xf5,0xb0,0x16,0xc7,0xd6,0xfa,0x5e,0xb8,0x73,0xaf,0xa3,  
			0x01,0xae,0x34,0x6c,0x05,0x35,0xaf,0xa1,0xe3,0x6a,0x4b,0xf6,0x05,0x92,0xe9,0xb9,  
			0x4f,0x89,0xf0,0x67,0x8f,0x36,0xee,0xd5,0x65,0x9c,0xe6,0x87,0x21,0xca,0x73,0xf7,  
			0x86,0xaf,0xaa,0x4b,0x4f,0x0e,0x12,0x35,0x37,0x3f,0x74,0x0d,0x31,0xf3,0x49,0xd3  
	};
	CK_BYTE     Prime1Exponent[64]={
		0x7f,0x9d,0x95,0x80,0x3a,0x8f,0xc1,0x79,0x22,0x6b,0x92,0x04,0x8c,0x04,0x90,0xaf,  
			0x83,0x03,0x28,0x8a,0x97,0xdd,0xf5,0xb1,0xaa,0x66,0x07,0xb1,0x5a,0xec,0xaf,0xa8,  
			0x47,0xa8,0x43,0xd1,0xe9,0x1c,0xa4,0x1d,0x44,0xc0,0x16,0x7e,0x39,0xe1,0x65,0x06,  
			0xad,0x80,0xae,0x06,0x16,0x71,0xbe,0xdb,0x8b,0x1b,0x8b,0x40,0x9f,0xa4,0xff,0x9b  
	};
	CK_BYTE     Prime2Exponent[64]={
		0xb3,0xff,0xd1,0x99,0x6a,0x5c,0xb6,0x45,0xda,0x4b,0x28,0xc6,0xcd,0x83,0x4a,0x9c,  
			0x71,0x70,0x18,0x5d,0x5a,0xd6,0x42,0xa2,0x76,0x35,0x90,0x74,0x42,0x95,0xc4,0xf5,  
			0x9b,0x34,0x8e,0x2e,0x66,0xf9,0xd9,0x85,0xf6,0x0c,0xfc,0x9b,0x8d,0x18,0x30,0xab,  
			0x07,0x14,0x56,0x40,0xfc,0x63,0x04,0x4f,0x95,0x27,0xea,0x5f,0xec,0x43,0x9b,0x2b  
	};
	CK_BYTE     Coefficient[64]={
		0x13,0xa5,0x71,0x23,0xb3,0x9e,0x90,0x42,0x3a,0xd5,0x45,0x68,0x70,0x9d,0x79,0x0e,  
			0xed,0x07,0x3a,0xe8,0x4d,0xab,0xe9,0x8b,0x3e,0x03,0xcc,0x73,0x5d,0x48,0x6b,0xcb,  
			0xf5,0x95,0x95,0x37,0x7c,0x37,0x0d,0x1f,0x64,0xe3,0x4c,0x49,0xd1,0x55,0x4d,0x13,  
			0x2b,0x94,0x50,0x71,0xd5,0xaf,0xfe,0x34,0xc5,0x4e,0xfa,0xcf,0x78,0x96,0x7b,0x70 
	};	
	CK_ATTRIBUTE RSApublicKeyTemplate[] = {		
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &RSApubclass, sizeof(CK_OBJECT_CLASS)},
		//{CKA_PRIVATE, &ttrue, sizeof(ttrue)},
		//{CKA_ENCRYPT, &ttrue, sizeof(ttrue)},
		//{CKA_VERIFY, &ttrue, sizeof(ttrue)},
		{CKA_LABEL, (CK_VOID_PTR)"test key", 9},
		{CKA_KEY_TYPE,&RSAkeyType,sizeof(CK_KEY_TYPE)},
		{CKA_MODULUS_BITS, &RSAmodulusBits, sizeof(CK_UINT)},
		{CKA_MODULUS, Modulus, sizeof(Modulus)},
		{CKA_PUBLIC_EXPONENT, PublicExponent, sizeof(PublicExponent)}
	};
	CK_ATTRIBUTE RSAprivateKeyTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &RSApriclass, sizeof(CK_OBJECT_CLASS)},
		//{CKA_PRIVATE, &ttrue, sizeof(ttrue)},
		//{CKA_DECRYPT, &ttrue, sizeof(ttrue)},
		//{CKA_SIGN, &ttrue, sizeof(ttrue)},
		{CKA_KEY_TYPE,&RSAkeyType,sizeof(CK_KEY_TYPE)},
		//{CKA_MODULUS_BITS, &RSAmodulusBits, sizeof(CK_ULONG)},
		{CKA_PRIVATE_EXPONENT, PrivateExponent, sizeof(PrivateExponent)},
		{CKA_PRIME_1, Prime1, sizeof(Prime1)},
		{CKA_PRIME_2, Prime2, sizeof(Prime2)},
		{CKA_EXPONENT_1, Prime1Exponent, sizeof(Prime1Exponent)},
		{CKA_EXPONENT_2, Prime2Exponent, sizeof(Prime2Exponent)},
		{CKA_COEFFICIENT, Coefficient, sizeof(Coefficient)},
		{CKA_LABEL, (CK_VOID_PTR)"test key", 9},
		{CKA_ID, (CK_VOID_PTR)"test key", 9},
		{CKA_MODULUS, Modulus, sizeof(Modulus)},
		{CKA_PUBLIC_EXPONENT, PublicExponent, sizeof(PublicExponent)}
	};
	CK_ATTRIBUTE RSApubTemplate[] = {
		{CKA_CLASS, &RSApubclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_KEY_TYPE, &RSAkeyType, sizeof(CK_KEY_TYPE)},
		{CKA_TOKEN, &ttrue, sizeof(ttrue)}
	};
	CK_ATTRIBUTE RSApriTemplate[] = {
		{CKA_CLASS, &RSApriclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_KEY_TYPE, &RSAkeyType, sizeof(CK_KEY_TYPE)}
	};

	CK_KEY_TYPE  ECCkeyType=CKK_ECC;
	CK_OBJECT_CLASS ECCpubclass=CKO_PUBLIC_KEY,ECCpriclass=CKO_PRIVATE_KEY;
	CK_UINT     ECCmodulusBits = 256;
	CK_BYTE     temp_pub_x[32]={
		0xec,0x91,0x81,0x8d,0xe0,0xb7,0x01,0x21,0x73,0xf5,0x1c,0x33,0x75,0x43,0x6e,0x43,
			0xb6,0xa9,0xa2,0x6a,0xbd,0x6d,0xbc,0xb7,0x9f,0x85,0x1c,0xde,0xaf,0x7a,0x0f,0x6c
	};
	CK_BYTE     temp_pub_y[32]={
		0xcb,0xf4,0xb5,0xa1,0x5f,0xb8,0x7e,0x60,0xfc,0x0b,0x3a,0x92,0x3d,0x12,0xe8,0x66,
			0x36,0x4a,0x93,0x5f,0xfb,0x30,0x84,0x2b,0xc9,0x13,0x9e,0xbd,0x2d,0xdc,0xe9,0x61
	};
	CK_BYTE     temp_prv[32]={
		0xc5,0x6a,0x2b,0x58,0xa0,0x94,0xef,0x24,0x41,0x03,0x79,0x45,0xba,0xb1,0x39,0x8c,
			0xc0,0xdf,0x9f,0xc4,0xf9,0x9e,0x9a,0x60,0x2c,0xd8,0x6f,0xc2,0xc3,0x88,0xad,0x0c
	};
	CK_ATTRIBUTE ECCpublicKeyTemplate[] = {		
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &ECCpubclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_PRIVATE, &ttrue, sizeof(ttrue)},
		{CKA_ENCRYPT, &ttrue, sizeof(ttrue)},
		{CKA_VERIFY, &ttrue, sizeof(ttrue)},
		{CKA_KEY_TYPE,&ECCkeyType,sizeof(CK_KEY_TYPE)},
		{CKA_ECC_BITS_LEN, &ECCmodulusBits, sizeof(CK_UINT)},
		{CKA_ECC_X_COORDINATE, temp_pub_x, sizeof(temp_pub_x)},
		{CKA_ECC_Y_COORDINATE, temp_pub_y, sizeof(temp_pub_y)}
	};
	
	CK_ATTRIBUTE ECCprivateKeyTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &ECCpriclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_PRIVATE, &ttrue, sizeof(ttrue)},
		{CKA_DECRYPT, &ttrue, sizeof(ttrue)},
		{CKA_SIGN, &ttrue, sizeof(ttrue)},
		{CKA_KEY_TYPE,&ECCkeyType,sizeof(CK_KEY_TYPE)},
		{CKA_ECC_BITS_LEN, &ECCmodulusBits, sizeof(CK_UINT)},
		{CKA_ECC_PRIVATE, temp_prv, sizeof(temp_prv)},
	};
	CK_ATTRIBUTE ECCpubTemplate[] = {
		{CKA_CLASS, &ECCpubclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_KEY_TYPE, &ECCkeyType, sizeof(CK_KEY_TYPE)}
	};
	CK_ATTRIBUTE ECCpriTemplate[] = {
		{CKA_CLASS, &ECCpriclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_KEY_TYPE, &ECCkeyType, sizeof(CK_KEY_TYPE)}
	};

	CK_BYTE data[]={'1','2','3','4','\0'};
	CK_OBJECT_CLASS dataclass=CKO_DATA;
	CK_ATTRIBUTE pubdataTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &dataclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_VALUE, data, 4}
	};
	CK_ATTRIBUTE pubdatafindtemplate[] = {
		{CKA_CLASS, &dataclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_PRIVATE, &tfalse, sizeof(ttrue)},
	};
	CK_ATTRIBUTE pridataTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &dataclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_PRIVATE, &ttrue, sizeof(ttrue)},
		{CKA_VALUE, data, 4},
	};
	CK_ATTRIBUTE pridatafindtemplate[] = {
		{CKA_CLASS, &dataclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_PRIVATE, &ttrue, sizeof(ttrue)}
	};

	//有效证书的value
	CK_BYTE cert[]={0x30,0x82,0x05,0x6D,0x30,0x82,0x04,0x55,0xA0,0x03,0x02,0x01,0x02,0x02,0x0A,0x22,
		0x09,0x63,0xB1,0x00,0x00,0x00,0x00,0x64,0x45,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,
		0x86,0xF7,0x0D,0x01,0x01,0x05,0x05,0x00,0x30,0x3E,0x31,0x13,0x30,0x11,0x06,0x0A,
		0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,0x03,0x63,0x6F,0x6D,0x31,
		0x18,0x30,0x16,0x06,0x0A,0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,
		0x08,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x31,0x0D,0x30,0x0B,0x06,0x03,0x55,
		0x04,0x03,0x13,0x04,0x42,0x4A,0x49,0x53,0x30,0x1E,0x17,0x0D,0x31,0x33,0x30,0x36,
		0x30,0x34,0x30,0x35,0x34,0x38,0x32,0x33,0x5A,0x17,0x0D,0x31,0x34,0x30,0x36,0x30,
		0x34,0x30,0x35,0x34,0x38,0x32,0x33,0x5A,0x30,0x58,0x31,0x13,0x30,0x11,0x06,0x0A,
		0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,0x03,0x63,0x6F,0x6D,0x31,
		0x18,0x30,0x16,0x06,0x0A,0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,
		0x08,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x31,0x18,0x30,0x16,0x06,0x03,0x55,
		0x04,0x0B,0x0C,0x0F,0x44,0x65,0x70,0x61,0x72,0x74,0x5F,0x69,0x6E,0x66,0x6F,0x74,
		0x65,0x63,0x68,0x31,0x0D,0x30,0x0B,0x06,0x03,0x55,0x04,0x03,0x13,0x04,0x74,0x65,
		0x73,0x74,0x30,0x81,0x9F,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,
		0x01,0x01,0x05,0x00,0x03,0x81,0x8D,0x00,0x30,0x81,0x89,0x02,0x81,0x81,0x00,0xBC,
		0x13,0x01,0xAE,0xF2,0x5F,0x39,0x5A,0xF2,0xB2,0x95,0xC3,0xD1,0x04,0x64,0x60,0x09,
		0xAA,0xAB,0x8B,0xA2,0x8F,0x00,0x4A,0x94,0x71,0x93,0xD9,0xD9,0xCA,0x39,0xAA,0xE9,
		0x6E,0xED,0xAE,0xA9,0x87,0x29,0x22,0xB3,0x52,0x40,0x2B,0xDE,0xC3,0x6F,0x0D,0x8B,
		0xDD,0x74,0x89,0xE0,0x82,0xD1,0xDB,0x7F,0x8E,0xD0,0x8E,0x66,0x5A,0x2C,0x80,0x2C,
		0xCF,0xEB,0x31,0x77,0x54,0xC8,0x16,0xBA,0xE9,0x76,0x56,0x89,0x52,0xA1,0x09,0xA3,
		0xBA,0xC7,0x0E,0x3F,0xF9,0xBE,0x7C,0x1A,0xA7,0x3B,0xC0,0xFF,0x60,0x40,0x1A,0xCE,
		0xA0,0x1A,0xF1,0xD6,0x33,0xF2,0xBD,0xB3,0x0F,0x30,0x39,0x1D,0x25,0xC2,0xDF,0xA5,
		0x58,0xE7,0xD4,0x69,0x79,0xAC,0x3B,0x0D,0xDF,0x1C,0xAD,0xC1,0x9E,0xA3,0x6D,0x02,
		0x03,0x01,0x00,0x01,0xA3,0x82,0x02,0xD5,0x30,0x82,0x02,0xD1,0x30,0x0B,0x06,0x03,
		0x55,0x1D,0x0F,0x04,0x04,0x03,0x02,0x05,0xA0,0x30,0x1D,0x06,0x03,0x55,0x1D,0x0E,
		0x04,0x16,0x04,0x14,0x39,0x6B,0x69,0x14,0x6F,0x73,0x4B,0x5B,0xC9,0xDE,0x86,0x9D,
		0xC1,0x25,0xF8,0x12,0x5B,0x4A,0x34,0x8F,0x30,0x2B,0x06,0x09,0x2B,0x06,0x01,0x04,
		0x01,0x82,0x37,0x14,0x02,0x04,0x1E,0x1E,0x1C,0x00,0x53,0x00,0x6D,0x00,0x61,0x00,
		0x72,0x00,0x74,0x00,0x63,0x00,0x61,0x00,0x72,0x00,0x64,0x00,0x4C,0x00,0x6F,0x00,
		0x67,0x00,0x6F,0x00,0x6E,0x30,0x1F,0x06,0x03,0x55,0x1D,0x23,0x04,0x18,0x30,0x16,
		0x80,0x14,0xC8,0x7A,0xC5,0x17,0x08,0x7F,0x56,0x4D,0x5A,0x45,0xBE,0x6B,0x71,0x09,
		0xD0,0x05,0xDE,0x6F,0x5B,0x04,0x30,0x81,0xF6,0x06,0x03,0x55,0x1D,0x1F,0x04,0x81,
		0xEE,0x30,0x81,0xEB,0x30,0x81,0xE8,0xA0,0x81,0xE5,0xA0,0x81,0xE2,0x86,0x81,0xAD,
		0x6C,0x64,0x61,0x70,0x3A,0x2F,0x2F,0x2F,0x43,0x4E,0x3D,0x42,0x4A,0x49,0x53,0x2C,
		0x43,0x4E,0x3D,0x53,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2C,0x43,0x4E,0x3D,0x43,
		0x44,0x50,0x2C,0x43,0x4E,0x3D,0x50,0x75,0x62,0x6C,0x69,0x63,0x25,0x32,0x30,0x4B,
		0x65,0x79,0x25,0x32,0x30,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,
		0x3D,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,0x3D,0x43,0x6F,0x6E,
		0x66,0x69,0x67,0x75,0x72,0x61,0x74,0x69,0x6F,0x6E,0x2C,0x44,0x43,0x3D,0x4D,0x69,
		0x63,0x72,0x6F,0x53,0x65,0x63,0x2C,0x44,0x43,0x3D,0x63,0x6F,0x6D,0x3F,0x63,0x65,
		0x72,0x74,0x69,0x66,0x69,0x63,0x61,0x74,0x65,0x52,0x65,0x76,0x6F,0x63,0x61,0x74,
		0x69,0x6F,0x6E,0x4C,0x69,0x73,0x74,0x3F,0x62,0x61,0x73,0x65,0x3F,0x6F,0x62,0x6A,
		0x65,0x63,0x74,0x43,0x6C,0x61,0x73,0x73,0x3D,0x63,0x52,0x4C,0x44,0x69,0x73,0x74,
		0x72,0x69,0x62,0x75,0x74,0x69,0x6F,0x6E,0x50,0x6F,0x69,0x6E,0x74,0x86,0x30,0x68,
		0x74,0x74,0x70,0x3A,0x2F,0x2F,0x73,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x6D,
		0x69,0x63,0x72,0x6F,0x73,0x65,0x63,0x2E,0x63,0x6F,0x6D,0x2F,0x43,0x65,0x72,0x74,
		0x45,0x6E,0x72,0x6F,0x6C,0x6C,0x2F,0x42,0x4A,0x49,0x53,0x2E,0x63,0x72,0x6C,0x30,
		0x82,0x01,0x0B,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,0x07,0x01,0x01,0x04,0x81,0xFE,
		0x30,0x81,0xFB,0x30,0x81,0xA4,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,0x07,0x30,0x02,
		0x86,0x81,0x97,0x6C,0x64,0x61,0x70,0x3A,0x2F,0x2F,0x2F,0x43,0x4E,0x3D,0x42,0x4A,
		0x49,0x53,0x2C,0x43,0x4E,0x3D,0x41,0x49,0x41,0x2C,0x43,0x4E,0x3D,0x50,0x75,0x62,
		0x6C,0x69,0x63,0x25,0x32,0x30,0x4B,0x65,0x79,0x25,0x32,0x30,0x53,0x65,0x72,0x76,
		0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,0x3D,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,
		0x2C,0x43,0x4E,0x3D,0x43,0x6F,0x6E,0x66,0x69,0x67,0x75,0x72,0x61,0x74,0x69,0x6F,
		0x6E,0x2C,0x44,0x43,0x3D,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x2C,0x44,0x43,
		0x3D,0x63,0x6F,0x6D,0x3F,0x63,0x41,0x43,0x65,0x72,0x74,0x69,0x66,0x69,0x63,0x61,
		0x74,0x65,0x3F,0x62,0x61,0x73,0x65,0x3F,0x6F,0x62,0x6A,0x65,0x63,0x74,0x43,0x6C,
		0x61,0x73,0x73,0x3D,0x63,0x65,0x72,0x74,0x69,0x66,0x69,0x63,0x61,0x74,0x69,0x6F,
		0x6E,0x41,0x75,0x74,0x68,0x6F,0x72,0x69,0x74,0x79,0x30,0x52,0x06,0x08,0x2B,0x06,
		0x01,0x05,0x05,0x07,0x30,0x02,0x86,0x46,0x68,0x74,0x74,0x70,0x3A,0x2F,0x2F,0x73,
		0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x6D,0x69,0x63,0x72,0x6F,0x73,0x65,0x63,
		0x2E,0x63,0x6F,0x6D,0x2F,0x43,0x65,0x72,0x74,0x45,0x6E,0x72,0x6F,0x6C,0x6C,0x2F,
		0x53,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,
		0x63,0x2E,0x63,0x6F,0x6D,0x5F,0x42,0x4A,0x49,0x53,0x2E,0x63,0x72,0x74,0x30,0x1F,
		0x06,0x03,0x55,0x1D,0x25,0x04,0x18,0x30,0x16,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,
		0x07,0x03,0x02,0x06,0x0A,0x2B,0x06,0x01,0x04,0x01,0x82,0x37,0x14,0x02,0x02,0x30,
		0x2C,0x06,0x03,0x55,0x1D,0x11,0x04,0x25,0x30,0x23,0xA0,0x21,0x06,0x0A,0x2B,0x06,
		0x01,0x04,0x01,0x82,0x37,0x14,0x02,0x03,0xA0,0x13,0x0C,0x11,0x74,0x65,0x73,0x74,
		0x40,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x2E,0x63,0x6F,0x6D,0x30,0x0D,0x06,
		0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,0x01,0x05,0x05,0x00,0x03,0x82,0x01,0x01,
		0x00,0x79,0x84,0x2F,0x6E,0x39,0x9C,0x0A,0xC8,0xDE,0x9E,0x2B,0xEA,0x5D,0xD4,0x88,
		0x04,0x98,0xFA,0x60,0x90,0x9E,0xEA,0xBC,0xBE,0x95,0xAB,0x3E,0xA8,0x52,0xF6,0x96,
		0x65,0x7B,0x1A,0x5A,0x46,0x0D,0x3A,0x12,0xE1,0x4F,0x8F,0xF8,0xDE,0xB6,0x5F,0x88,
		0xBF,0xDB,0xEF,0x08,0x11,0x16,0x9E,0xCA,0x35,0x4A,0xE6,0x76,0xA9,0x87,0xD5,0x5B,
		0x3D,0x7D,0x8F,0x9B,0x14,0xA4,0x69,0x6F,0x1F,0xEC,0xB7,0x36,0x8D,0xD2,0x04,0xF4,
		0x0D,0x70,0x4E,0xE8,0xF0,0xF2,0xDA,0x4E,0x8C,0x8F,0x12,0xF5,0x29,0x4A,0xC1,0x25,
		0x26,0x3E,0x7A,0x26,0x5E,0x78,0x6B,0x5D,0xED,0x14,0x57,0xDA,0x01,0xC7,0x36,0xCD,
		0xD1,0xA9,0xC9,0x53,0x4F,0xB2,0xDD,0xB1,0xB0,0x11,0x05,0x57,0xFA,0x75,0x7C,0x24,
		0x81,0xD1,0xEF,0xE2,0x1D,0x5B,0x59,0x9B,0x4C,0x14,0x6C,0x4E,0x6D,0xEF,0xDB,0x20,
		0x75,0x7A,0x96,0x81,0x46,0xA6,0x13,0xC5,0xD5,0x69,0x45,0x32,0xE7,0x3F,0x24,0x48,
		0x6A,0xCF,0xA5,0x5A,0x20,0x8C,0x43,0xF3,0xDB,0x66,0x6E,0x45,0x2B,0x5D,0x3A,0x5C,
		0x4E,0xA5,0x5F,0x09,0x70,0xBF,0xF5,0x6A,0x3A,0xA9,0xCA,0x4C,0x2D,0x93,0x3C,0x6C,
		0xB3,0xFA,0xA4,0x2F,0x8F,0x75,0x97,0xD2,0x85,0xF4,0x51,0x18,0x38,0x48,0xE7,0xEA,
		0x89,0x66,0x55,0x26,0x28,0x30,0x7F,0xA4,0x3F,0xE9,0xC7,0x99,0xAA,0x41,0x2B,0xEC,
		0x2B,0x17,0x3B,0x33,0x1E,0xCA,0xFD,0xF5,0x19,0xD4,0xF3,0xBD,0x7F,0xEE,0x65,0x03,
		0xB7,0xDD,0xBC,0x95,0x2D,0xDA,0x58,0x95,0x99,0x25,0x84,0xEC,0xC5,0xE0,0xE6,0x29,
		0x7E};
	CK_OBJECT_CLASS certclass=CKO_CERTIFICATE;
	CK_CERTIFICATE_TYPE certtype=CKC_X_509;
	CK_BYTE subject[] = {'s','u','b','j','e','c','t'};
	CK_BYTE issuer[] = {'i','s','s','u','e','r'};
	CK_BYTE SN[] = {'1','2','3','4','5','6'};
	CK_ATTRIBUTE certTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &certclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_CERTIFICATE_TYPE, &certtype, sizeof(CK_CERTIFICATE_TYPE)},
		{CKA_SUBJECT, subject, sizeof(subject)},
		{CKA_ISSUER,  issuer, sizeof(issuer)},
		{CKA_SERIAL_NUMBER, SN, sizeof(SN)},
		{CKA_VALUE, cert, sizeof(cert)}
	};
	CK_ATTRIBUTE certfindtemplate[] = {
		{CKA_CLASS, &certclass, sizeof(CK_OBJECT_CLASS)},
	};

	CK_ATTRIBUTE *ptemplate[7]={RSApublicKeyTemplate,RSAprivateKeyTemplate,ECCpublicKeyTemplate,ECCprivateKeyTemplate,
								pubdataTemplate,pridataTemplate,certTemplate};
	CK_ULONG      ulCount[7]={sizeof(RSApublicKeyTemplate)/sizeof(CK_ATTRIBUTE),sizeof(RSAprivateKeyTemplate)/sizeof(CK_ATTRIBUTE),
						      sizeof(ECCpublicKeyTemplate)/sizeof(CK_ATTRIBUTE),sizeof(ECCprivateKeyTemplate)/sizeof(CK_ATTRIBUTE),
	                          sizeof(pubdataTemplate)/sizeof(CK_ATTRIBUTE),sizeof(pridataTemplate)/sizeof(CK_ATTRIBUTE),
							  sizeof(certTemplate)/sizeof(CK_ATTRIBUTE)};
	CK_ATTRIBUTE *ptemplate1[7]={RSApubTemplate,RSApriTemplate,ECCpubTemplate,ECCpriTemplate,
								pubdatafindtemplate,pridatafindtemplate,certfindtemplate};
	CK_ULONG      ulCount1[7]={sizeof(RSApubTemplate)/sizeof(CK_ATTRIBUTE),sizeof(RSApriTemplate)/sizeof(CK_ATTRIBUTE),
							   sizeof(ECCpubTemplate)/sizeof(CK_ATTRIBUTE),sizeof(ECCpriTemplate)/sizeof(CK_ATTRIBUTE),
							   sizeof(pubdatafindtemplate)/sizeof(CK_ATTRIBUTE),sizeof(pridatafindtemplate)/sizeof(CK_ATTRIBUTE),
							   sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE)};


	printf("enter test_objects.\n");
	
	for(i=0;i<7;i++)
	{
		rv = (*pC_CreateObject)(hSession,ptemplate[i], ulCount[i], &htempobject);
		if(rv!=CKR_OK)
		{
			printf("test_objects failed,pC_CreateObject. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}

		/*rv = (*pC_CreateObject)(hSession,ptemplate[i], ulCount[i], &htempobject);
		if(rv!=CKR_OK)
		{
			printf("test_objects failed,pC_CreateObject. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}
		
		rv=(*pC_GetObjectSize)(hSession,htempobject,&ulSize);
		if(rv!=CKR_OK)
		{
			printf("test_objects failed,pC_GetObjectSize. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}*/


		rv = pC_FindObjectsInit(hSession, ptemplate1[i], ulCount1[i]);
		if(rv!=CKR_OK)
		{
			printf("test_objects failed,pC_FindObjectsInit. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}
		
		rv = pC_FindObjects(hSession,hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
		if((rv!=CKR_OK)||(ulObjectCount==0))
		{
			printf("test_objects failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}

		printf(" C_FindObjects count %d.\n",ulObjectCount);
		for(j=0;j<ulObjectCount;j++)
		{
			printf(" Get Object %d Attr.\n",j);
			get_obj_attr(hSession,hObject[j]);
		}
		
		rv = pC_FindObjectsFinal(hSession);
		if(rv!=CKR_OK)
		{
			printf("test_objects failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}
		
		rv = pC_DestroyObject(hSession,htempobject);
		if(rv!=CKR_OK)
		{
			printf("test_objects failed,pC_DestroyObject. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}
	}

	return TRUE;
}


void test_object_attribute()
{
	CK_OBJECT_HANDLE hData;
	CK_OBJECT_CLASS	dataClass = CKO_DATA, certificateClass = CKO_CERTIFICATE, keyClass = CKO_PUBLIC_KEY;
	CK_KEY_TYPE keyType = CKK_RSA;
	CK_CHAR application[] = {"My Application"};
	CK_BYTE dataValue[] = {0x77,0x88};
	CK_BYTE subject[] = {0x31,0x32};
	CK_BYTE id[] = {0x33,0x34};
	CK_BYTE certificateValue[] = {0x33,0x34,0x33,0x34};
	CK_BYTE modulus[] = {0x33,0x34};
	CK_BYTE exponent[] = {0x33,0x34};
	CK_BBOOL _true = CK_TRUE;
	CK_ATTRIBUTE dataTemplate[] = {
		{CKA_CLASS, &dataClass, sizeof(dataClass)},
		{CKA_PRIVATE, &_true, sizeof(_true)},
		{CKA_TOKEN, &_true, sizeof(_true)},
		{CKA_APPLICATION, application, sizeof(application)},
		{CKA_VALUE, dataValue, sizeof(dataValue)}
	};
	CK_ATTRIBUTE certificateTemplate[] = {
		{CKA_CLASS, &certificateClass, sizeof(certificateClass)},
		{CKA_TOKEN, &_true, sizeof(_true)},
		{CKA_SUBJECT, subject, sizeof(subject)},
		{CKA_ID, id, sizeof(id)},
		{CKA_VALUE, certificateValue, sizeof(certificateValue)}
	};
	CK_ATTRIBUTE keyTemplate[] = {
		{CKA_CLASS, &keyClass, sizeof(keyClass)},
		{CKA_KEY_TYPE, &keyType, sizeof(keyType)},
		{CKA_WRAP, &_true, sizeof(_true)},
		{CKA_MODULUS, modulus, sizeof(modulus)},
		{CKA_PUBLIC_EXPONENT, exponent, sizeof(exponent)}
	};
	CK_RV rv;

	CK_ULONG i = 0;

	CK_OBJECT_HANDLE hObjs[3]={CK_INVALID_HANDLE};
	CK_ULONG ulObjCount=0;

	rv=pC_FindObjectsInit(hSession,dataTemplate,sizeof(dataTemplate)/sizeof(dataTemplate[0]));
	assert(rv==CKR_OK);
	rv=pC_FindObjects(hSession,hObjs,3,&ulObjCount);
	assert(rv==CKR_OK);
	rv=pC_FindObjectsFinal(hSession);
	assert(rv==CKR_OK);

	if (!ulObjCount)
	{
		rv=pC_CreateObject(hSession,dataTemplate,sizeof(dataTemplate)/sizeof(dataTemplate[0]),&hData);
		assert(rv==CKR_OK);
	}
	else
	{
		hData = hObjs[0];
	}
	
	CK_BYTE app_buff[100]={0};
	CK_BYTE val_buff[100]={0};
	CK_ATTRIBUTE dataTemplate_get[] = {
		{CKA_APPLICATION, NULL, 0},
		{CKA_VALUE, NULL, 0}
	};
	rv=pC_GetAttributeValue(hSession,hData,dataTemplate_get,2);
	assert(rv==CKR_OK);

	dataTemplate_get[0].pValue=app_buff;
	dataTemplate_get[0].ulValueLen=sizeof(app_buff);
	dataTemplate_get[1].pValue=val_buff;
	dataTemplate_get[1].ulValueLen=sizeof(val_buff);
	rv=pC_GetAttributeValue(hSession,hData,dataTemplate_get,2);
	assert(rv==CKR_OK);

	printf("CKA_APPLICATION: ");
	for (i=0; i<dataTemplate_get[0].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[0].pValue) + i));
	}
	printf("\n");
	printf("CKA_VALUE: ");
	for (i=0; i<dataTemplate_get[1].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[1].pValue) + i));
	}
	printf("\n");
	getchar();
	getchar();

	memset(app_buff, 0, sizeof(app_buff));
	dataTemplate_get[0].pValue=app_buff;
	dataTemplate_get[0].ulValueLen=sizeof(app_buff);
	dataTemplate_get[1].pValue=val_buff;
	dataTemplate_get[1].ulValueLen=sizeof(val_buff);
	val_buff[0]=0x99;
	val_buff[1]=0x99;
	dataTemplate_get[1].ulValueLen=2;
	rv=pC_SetAttributeValue(hSession,hData,&dataTemplate_get[1],1);
	assert(rv==CKR_OK);

	val_buff[0]=0x00;
	val_buff[1]=0x00;

	dataTemplate_get[0].pValue=app_buff;
	dataTemplate_get[0].ulValueLen=sizeof(app_buff);
	dataTemplate_get[1].pValue=val_buff;
	dataTemplate_get[1].ulValueLen=sizeof(val_buff);
	rv=pC_GetAttributeValue(hSession,hData,dataTemplate_get,2);
	assert(rv==CKR_OK);

	printf("CKA_APPLICATION: ");
	for (i=0; i<dataTemplate_get[0].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[0].pValue) + i));
	}
	printf("\n");
	printf("CKA_VALUE: ");
	for (i=0; i<dataTemplate_get[1].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[1].pValue) + i));
	}
	printf("\n");
	getchar();

	CK_OBJECT_HANDLE hDataCopy=CK_INVALID_HANDLE;
	rv=pC_CopyObject(hSession,hData,NULL,0,&hDataCopy);
	assert(rv==CKR_OK);

// 	val_buff[0]=0x99;
// 	val_buff[1]=0x99;
// 	rv=pC_SetAttributeValue(hSession,hDataCopy,dataTemplate_get,2);
// 	assert(rv==CKR_OK);

	memset(app_buff,0,sizeof(app_buff));
	memset(val_buff,0,sizeof(val_buff));
	rv=pC_GetAttributeValue(hSession,hDataCopy,dataTemplate_get,2);
	assert(rv==CKR_OK);

	printf("CKA_APPLICATION: ");
	for (i=0; i<dataTemplate_get[0].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[0].pValue) + i));
	}
	printf("\n");
	printf("CKA_VALUE: ");
	for (i=0; i<dataTemplate_get[1].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[1].pValue) + i));
	}
	printf("\n");
	getchar();

	CK_ULONG ulObjSize=0;
	rv=pC_GetObjectSize(hSession,hData,&ulObjSize);
	assert(rv==CKR_OK);

	ulObjSize=0;
	rv=pC_GetObjectSize(hSession,hDataCopy,&ulObjSize);
	assert(rv==CKR_OK);

	rv=pC_DestroyObject(hSession,hDataCopy);
	assert(rv==CKR_OK);

	rv=pC_DestroyObject(hSession,hData);
	assert(rv==CKR_OK);

	rv=pC_FindObjectsInit(hSession,dataTemplate,sizeof(dataTemplate)/sizeof(dataTemplate[0]));
	assert(rv==CKR_OK);
	rv=pC_FindObjects(hSession,hObjs,3,&ulObjCount);
	assert(rv==CKR_OK);
	rv=pC_FindObjectsFinal(hSession);
	assert(rv==CKR_OK);
}

void test_object_attribute_read()
{
	CK_OBJECT_HANDLE hData;
	CK_OBJECT_CLASS	dataClass = CKO_DATA, certificateClass = CKO_CERTIFICATE, keyClass = CKO_PUBLIC_KEY;
	CK_KEY_TYPE keyType = CKK_RSA;
	CK_CHAR application[] = {"My Application"};
	CK_BYTE dataValue[] = {0x77,0x88};
	CK_BYTE subject[] = {0x31,0x32};
	CK_BYTE id[] = {0x33,0x34};
	CK_BYTE certificateValue[] = {0x33,0x34,0x33,0x34};
	CK_BYTE modulus[] = {0x33,0x34};
	CK_BYTE exponent[] = {0x33,0x34};
	CK_BBOOL _true = CK_TRUE;
	CK_ATTRIBUTE dataTemplate[] = {
		{CKA_CLASS, &dataClass, sizeof(dataClass)},
		{CKA_PRIVATE, &_true, sizeof(_true)},
		{CKA_TOKEN, &_true, sizeof(_true)},
		{CKA_APPLICATION, application, sizeof(application)},
		{CKA_VALUE, dataValue, sizeof(dataValue)}
	};
	CK_ATTRIBUTE certificateTemplate[] = {
		{CKA_CLASS, &certificateClass, sizeof(certificateClass)},
		{CKA_TOKEN, &_true, sizeof(_true)},
		{CKA_SUBJECT, subject, sizeof(subject)},
		{CKA_ID, id, sizeof(id)},
		{CKA_VALUE, certificateValue, sizeof(certificateValue)}
	};
	CK_ATTRIBUTE keyTemplate[] = {
		{CKA_CLASS, &keyClass, sizeof(keyClass)},
		{CKA_KEY_TYPE, &keyType, sizeof(keyType)},
		{CKA_WRAP, &_true, sizeof(_true)},
		{CKA_MODULUS, modulus, sizeof(modulus)},
		{CKA_PUBLIC_EXPONENT, exponent, sizeof(exponent)}
	};
	CK_RV rv;

	CK_ULONG i = 0;

	CK_OBJECT_HANDLE hObjs[3]={CK_INVALID_HANDLE};
	CK_ULONG ulObjCount=0;

	rv=pC_FindObjectsInit(hSession,dataTemplate,sizeof(dataTemplate)/sizeof(dataTemplate[0])-1);//不包含VALUE
	assert(rv==CKR_OK);
	rv=pC_FindObjects(hSession,hObjs,3,&ulObjCount);
	assert(rv==CKR_OK);
	rv=pC_FindObjectsFinal(hSession);
	assert(rv==CKR_OK);

	if (!ulObjCount)
	{
		rv=pC_CreateObject(hSession,dataTemplate,sizeof(dataTemplate)/sizeof(dataTemplate[0]),&hData);
		assert(rv==CKR_OK);
	}
	else
	{
		hData = hObjs[0];
	}

	CK_BYTE app_buff[100]={0};
	CK_BYTE val_buff[100]={0};
	CK_ATTRIBUTE dataTemplate_get[] = {
		{CKA_APPLICATION, NULL, 0},
		{CKA_VALUE, NULL, 0}
	};
	rv=pC_GetAttributeValue(hSession,hData,dataTemplate_get,2);
	assert(rv==CKR_OK);

	dataTemplate_get[0].pValue=app_buff;
	dataTemplate_get[0].ulValueLen=sizeof(app_buff);
	dataTemplate_get[1].pValue=val_buff;
	dataTemplate_get[1].ulValueLen=sizeof(val_buff);
	rv=pC_GetAttributeValue(hSession,hData,dataTemplate_get,2);
	assert(rv==CKR_OK);

	printf("CKA_APPLICATION: ");
	for (i=0; i<dataTemplate_get[0].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[0].pValue) + i));
	}
	printf("\n");
	printf("CKA_VALUE: ");
	for (i=0; i<dataTemplate_get[1].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[1].pValue) + i));
	}
	printf("\n");
	getchar();
	getchar();


	val_buff[0]=0x00;
	val_buff[1]=0x00;
	dataTemplate_get[0].pValue=app_buff;
	dataTemplate_get[0].ulValueLen=sizeof(app_buff);
	dataTemplate_get[1].pValue=val_buff;
	dataTemplate_get[1].ulValueLen=sizeof(val_buff);
	rv=pC_GetAttributeValue(hSession,hData,dataTemplate_get,2);
	assert(rv==CKR_OK);

	printf("CKA_APPLICATION: ");
	for (i=0; i<dataTemplate_get[0].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[0].pValue) + i));
	}
	printf("\n");
	printf("CKA_VALUE: ");
	for (i=0; i<dataTemplate_get[1].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[1].pValue) + i));
	}
	printf("\n");
	getchar();
}

bool test_data_objects()
{
	CK_RV rv=0;
	CK_OBJECT_HANDLE htempobject=0;
	CK_OBJECT_HANDLE hObject[16];
	CK_ULONG ulObjectCount=0,j=0;
	int i=0;
	CK_ULONG ulSize=0;
	
	CK_BBOOL         ttrue = CK_TRUE;
	CK_BBOOL         tfalse = CK_FALSE;

	CK_BYTE data[]={'1','2','3','4','\0'};
	CK_OBJECT_CLASS dataclass=CKO_DATA;
	CK_ATTRIBUTE pubdataTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &dataclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_VALUE, data, 4}
	};
	CK_ATTRIBUTE pubdatafindtemplate[] = {
		{CKA_CLASS, &dataclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_PRIVATE, &tfalse, sizeof(ttrue)},
	};
	CK_ATTRIBUTE pridataTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &dataclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_PRIVATE, &ttrue, sizeof(ttrue)},
		{CKA_VALUE, data, 4},
	};
	CK_ATTRIBUTE pridatafindtemplate[] = {
		{CKA_CLASS, &dataclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_PRIVATE, &ttrue, sizeof(ttrue)}
	};

	CK_ATTRIBUTE *ptemplate[2]={pubdataTemplate,pridataTemplate};
	CK_ULONG      ulCount[2]={ sizeof(pubdataTemplate)/sizeof(CK_ATTRIBUTE),sizeof(pridataTemplate)/sizeof(CK_ATTRIBUTE)};
	CK_ATTRIBUTE *ptemplate1[2]={pubdatafindtemplate,pridatafindtemplate};
	CK_ULONG      ulCount1[2]={sizeof(pubdatafindtemplate)/sizeof(CK_ATTRIBUTE),sizeof(pridatafindtemplate)/sizeof(CK_ATTRIBUTE)};


	printf("enter test_objects.\n");
	
	for(i=0;i<2;i++)
	{
		rv = (*pC_CreateObject)(hSession,ptemplate[i], ulCount[i], &htempobject);
		if(rv!=CKR_OK)
		{
			printf("test_objects failed,pC_CreateObject. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}

		rv = pC_FindObjectsInit(hSession, ptemplate1[i], ulCount1[i]);
		if(rv!=CKR_OK)
		{
			printf("test_objects failed,pC_FindObjectsInit. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}
		
		rv = pC_FindObjects(hSession,hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
		if((rv!=CKR_OK)||(ulObjectCount==0))
		{
			printf("test_objects failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}

		printf("C_FindObjects count %d.\n",ulObjectCount);
		for(j=0;j<ulObjectCount;j++)
		{
			printf("Get Object %d Attr.\n",j);
			get_obj_attr(hSession,hObject[j]);
		}
		
		rv = pC_FindObjectsFinal(hSession);
		if(rv!=CKR_OK)
		{
			printf("test_objects failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}
		
		rv = pC_DestroyObject(hSession,htempobject);
		if(rv!=CKR_OK)
		{
			printf("test_objects failed,pC_DestroyObject. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}
	}

	return TRUE;
}


CK_RV test_object_westone()
{
	CK_RV rv=0;
	int i=0;
	CK_MECHANISM      mechanism = {CKM_ECC_KEY_PAIR_GEN, NULL_PTR, 0};
	CK_ULONG     modulusBits = 256;
	CK_BYTE      subject[] = {0x00,0x01,0x02};
	CK_BYTE      id[] = {0x00,0x01,0x02,0x03};
	CK_BBOOL     ttrue = CK_TRUE;
	CK_KEY_TYPE  keyType=CKK_ECC;

	//查找相关
	LOCATION_ATTR_VALUE localAttrib = {0};
	CK_OBJECT_CLASS	pubkeyObj=CKO_PUBLIC_KEY;
	CK_OBJECT_CLASS	prvkeyObj=CKO_PRIVATE_KEY;
	CK_OBJECT_CLASS	certObj=CKO_CERTIFICATE;
	CK_CERTIFICATE_TYPE certType = CKC_X_509;
	CK_ATTRIBUTE	privateKeyFindTemplate[] = {
		{CKA_CLASS, &prvkeyObj, sizeof(CK_OBJECT_CLASS)},
		{CKA_KEY_TYPE, &keyType, sizeof(CK_KEY_TYPE)},
		{CKA_TOKEN, &ttrue, sizeof(CK_BBOOL)},
		{CKA_LOCATION_ATTRIBUTES, &localAttrib, sizeof(LOCATION_ATTR_VALUE)}
	};
	CK_ATTRIBUTE	publicKeyFindTemplate[] = {
		{CKA_CLASS, &pubkeyObj, sizeof(CK_OBJECT_CLASS)},
		{CKA_KEY_TYPE, &keyType, sizeof(CK_KEY_TYPE)},
		{CKA_TOKEN, &ttrue, sizeof(CK_BBOOL)},
		{CKA_LOCATION_ATTRIBUTES, &localAttrib, sizeof(LOCATION_ATTR_VALUE)}
	};
	CK_ATTRIBUTE	certificateFindTemplate[] = {
		{CKA_CLASS, &certObj, sizeof(CK_OBJECT_CLASS)},
		{CKA_CERTIFICATE_TYPE, &certType, sizeof(CK_CERTIFICATE_TYPE)},
		{CKA_TOKEN, &ttrue, sizeof(CK_BBOOL)},
		{CKA_LOCATION_ATTRIBUTES, &localAttrib, sizeof(LOCATION_ATTR_VALUE)}
	};

	CK_OBJECT_HANDLE hPrivateKeys[16]={0};
	CK_OBJECT_HANDLE hPublicKeys[16]={0};
	CK_OBJECT_HANDLE hCertificate[16]={0};
	CK_ULONG	ulObjCount = 16;

	CK_MECHANISM  mechanismcalc = {CKM_ECC_CALC, NULL_PTR, 0};
	CK_BYTE_PTR   pData=(CK_BYTE_PTR)"12345678901234567890123456789012";
	CK_ULONG      ulDataLen=strlen((char*)pData);
	CK_BYTE       pOutData[256];   
	CK_ULONG      ulOutDataLen=sizeof(pOutData);
	CK_BYTE       pOutData1[256];   
	CK_ULONG      ulOutDataLen1=sizeof(pOutData1);

	printf("enter test_object_westone.\n");
#if 0
	//查找签名私钥
	localAttrib.keyspec = CALG_ECC_SIGN;
	strcpy(localAttrib.szContainer, "ExchContainer");
	rv=pC_FindObjectsInit(hSession, privateKeyFindTemplate, 4);
	assert(rv==CKR_OK);
	rv=pC_FindObjects(hSession, hPrivateKeys, 16, &ulObjCount);
	assert(rv==CKR_OK);
	rv=pC_FindObjectsFinal(hSession);
	assert(rv==CKR_OK);

	printf("CALG_ECC_SIGN,privateKey,ulObjCount=%d\n",ulObjCount);

	//私钥签名
	ulOutDataLen=sizeof(pOutData);
	memset(pOutData,0,ulOutDataLen);
	rv=(*pC_SignInit)(hSession,&mechanismcalc,hPrivateKeys[0]);
	if(rv!=CKR_OK)
	{
		printf("test_ECC_pubpricalc failed,pC_SignInit. rv=0x%08x.\n",rv);
		return FALSE;
	}
	rv=(*pC_Sign)(hSession,pData,ulDataLen,pOutData,&ulOutDataLen);
	if(rv!=CKR_OK)
	{
		printf("test_ECC_pubpricalc failed,pC_Sign. rv=0x%08x.\n",rv);
		return FALSE;
	}

	//查找签名公钥
	localAttrib.keyspec = CALG_ECC_SIGN;
	strcpy(localAttrib.szContainer, "ExchContainer");
	rv=pC_FindObjectsInit(hSession, publicKeyFindTemplate, 4);
	assert(rv==CKR_OK);
	rv=pC_FindObjects(hSession, hPublicKeys, 16, &ulObjCount);
	assert(rv==CKR_OK);
	rv=pC_FindObjectsFinal(hSession);
	assert(rv==CKR_OK);

	printf("CALG_ECC_SIGN,publicKey,ulObjCount=%d\n",ulObjCount);

	//公钥验签
	rv=(*pC_VerifyInit)(hSession,&mechanismcalc,hPublicKeys[0]);
	if(rv!=CKR_OK)
	{
		printf("test_ECC_pubpricalc failed,pC_VerifyInit. rv=0x%08x.\n",rv);
		return FALSE;
	}
	rv=(*pC_Verify)(hSession,pData,ulDataLen,pOutData,ulOutDataLen);
	if(rv!=CKR_OK)
	{
		printf("test_ECC_pubpricalc failed,pC_Verify. rv=0x%08x.\n",rv);
		return FALSE;
	}

	//查找加密公钥
	localAttrib.keyspec = CALG_ECC_KEYX;
	strcpy(localAttrib.szContainer, "ExchContainer");
	rv=pC_FindObjectsInit(hSession, publicKeyFindTemplate, 4);
	assert(rv==CKR_OK);
	rv=pC_FindObjects(hSession, hPublicKeys, 16, &ulObjCount);
	assert(rv==CKR_OK);
	rv=pC_FindObjectsFinal(hSession);
	assert(rv==CKR_OK);

	printf("CALG_ECC_KEYX,publicKey,ulObjCount=%d\n",ulObjCount);

	//公钥加密
	ulOutDataLen=sizeof(pOutData);
	memset(pOutData,0,ulOutDataLen);
	rv=(*pC_EncryptInit)(hSession,&mechanismcalc,hPublicKeys[0]);
	if(rv!=CKR_OK)
	{
		printf("test_ECC_pubpricalc failed,pC_EncryptInit. rv=0x%08x.\n",rv);
		return FALSE;
	}
	rv=(*pC_Encrypt)(hSession,pData,ulDataLen,pOutData,&ulOutDataLen);
	if(rv!=CKR_OK)
	{
		printf("test_ECC_pubpricalc failed,pC_Encrypt. rv=0x%08x.\n",rv);
		return FALSE;
	}

	//查找加密私钥
	localAttrib.keyspec = CALG_ECC_KEYX;
	strcpy(localAttrib.szContainer, "ExchContainer");
	rv=pC_FindObjectsInit(hSession, privateKeyFindTemplate, 4);
	assert(rv==CKR_OK);
	rv=pC_FindObjects(hSession, hPrivateKeys, 16, &ulObjCount);
	assert(rv==CKR_OK);
	rv=pC_FindObjectsFinal(hSession);
	assert(rv==CKR_OK);

	printf("CALG_ECC_KEYX,privateKey,ulObjCount=%d\n",ulObjCount);
	//私钥解密
	rv=(*pC_DecryptInit)(hSession,&mechanismcalc,hPrivateKeys[0]);
	if(rv!=CKR_OK)
	{
		printf("test_ECC_pubpricalc failed,pC_DecryptInit. rv=0x%08x.\n",rv);
		return FALSE;
	}
	rv=(*pC_Decrypt)(hSession,pOutData,ulOutDataLen,pOutData1,&ulOutDataLen1);
	if(rv!=CKR_OK)
	{
		printf("test_ECC_pubpricalc failed,pC_Decrypt. rv=0x%08x.\n",rv);
		return FALSE;
	}
	if((ulOutDataLen1!=ulDataLen)||(memcmp(pOutData1,pData,ulDataLen)!=0))
	{
		printf("test_ECC_pubpricalc failed,解密数据与原始数据不一致.");
		return FALSE;
	}
#endif
	ulObjCount=3;
	//查找证书
	for (i=0;i<100;++i)
	{
	localAttrib.keyspec = AT_SIGNATURE;//AT_SIGNATURE,AT_KEYEXCHANGE
	strcpy(localAttrib.szContainer, "ExchContainer");
	rv=pC_FindObjectsInit(hSession, certificateFindTemplate, 4);
	assert(rv==CKR_OK);
	rv=pC_FindObjects(hSession, hCertificate, 16, &ulObjCount);
	assert(rv==CKR_OK);
	rv=pC_FindObjectsFinal(hSession);
	assert(rv==CKR_OK);

	printf("AT_SIGNATURE,certificate,ulObjCount=%d\n",ulObjCount);
	}
	CK_BYTE value[10240]={0};
	CK_ATTRIBUTE CerAttrVal[] = {
		{CKA_VALUE, NULL, 0}
	};

	rv=pC_GetAttributeValue(hSession,hCertificate[0],CerAttrVal,sizeof(CerAttrVal)/sizeof(CerAttrVal[0]));
	printf("NULL_AT_SIGNATURE,certificate,rv=%08x\n",rv);
	assert(rv==CKR_OK);
	
	CerAttrVal[0].pValue = (CK_BYTE_PTR) malloc(CerAttrVal[0].ulValueLen);

	rv=pC_GetAttributeValue(hSession,hCertificate[0],CerAttrVal,sizeof(CerAttrVal)/sizeof(CerAttrVal[0]));
	printf("OK_AT_SIGNATURE,certificate,rv=%08x\n",rv);
	assert(rv==CKR_OK);
	UtilsPrintData(VNAME(CerAttrVal[0].pValue),CerAttrVal[0].ulValueLen,0);

	ulObjCount=3;
	//查找证书
	localAttrib.keyspec = AT_SIGNATURE;//AT_SIGNATURE,AT_KEYEXCHANGE
	strcpy(localAttrib.szContainer, "ExchContainer");
	rv=pC_FindObjectsInit(hSession, certificateFindTemplate, 4);
	assert(rv==CKR_OK);
	rv=pC_FindObjects(hSession, hCertificate, 16, &ulObjCount);
	assert(rv==CKR_OK);
	rv=pC_FindObjectsFinal(hSession);
	assert(rv==CKR_OK);

	printf("AT_SIGNATURE,certificate,ulObjCount=%d\n",ulObjCount);

	CK_BYTE value1[1024]={0};
	CK_ATTRIBUTE dataTemplate_get1[] = {
		{CKA_VALUE, value1, 1024}
	};
	rv=pC_GetAttributeValue(hSession,hCertificate[0],dataTemplate_get1,1);
	printf("222AT_SIGNATURE,certificate,rv=%08x\n",rv);
	assert(rv==CKR_OK);
	UtilsPrintData(VNAME(value1),sizeof(value1),0);

	ulObjCount=3;
	//查找证书
	localAttrib.keyspec = AT_SIGNATURE;//AT_SIGNATURE,AT_KEYEXCHANGE
	strcpy(localAttrib.szContainer, "ExchContainer");
	rv=pC_FindObjectsInit(hSession, certificateFindTemplate, 4);
	assert(rv==CKR_OK);
	rv=pC_FindObjects(hSession, hCertificate, 16, &ulObjCount);
	assert(rv==CKR_OK);
	rv=pC_FindObjectsFinal(hSession);
	assert(rv==CKR_OK);

	printf("AT_SIGNATURE,certificate,ulObjCount=%d\n",ulObjCount);

	printf("\n");

#if 0
	dataTemplate_get[0].pValue=app_buff;
	dataTemplate_get[0].ulValueLen=sizeof(app_buff);
	dataTemplate_get[1].pValue=val_buff;
	dataTemplate_get[1].ulValueLen=sizeof(val_buff);
	rv=pC_GetAttributeValue(hSession,hCertificate[0],dataTemplate_get,2);
	assert(rv==CKR_OK);

	printf("CKA_APPLICATION: ");
	for (i=0; i<dataTemplate_get[0].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[0].pValue) + i));
	}
	printf("\n");
	printf("CKA_VALUE: ");
	for (i=0; i<dataTemplate_get[1].ulValueLen; i++)
	{
		printf("0x%x ", *((unsigned char*)(dataTemplate_get[1].pValue) + i));
	}
#endif
	printf("\n");

	return TRUE;
}





/*测试最多可支持多少对象*/
bool test_object_max_count()
{
	bool	bRtn = false;

	CK_BBOOL ttrue = CK_TRUE;
	CK_BBOOL ffalse = CK_FALSE;
	
	CK_RV	rv = 0;
	CK_OBJECT_HANDLE hPublicKey = NULL_PTR, hPrivateKey = NULL_PTR, hCertificate = NULL_PTR;
	int i = 0, iMaxCount = 16;

	printf("enter test_object_max_count.\n");

	CK_BYTE     prv[32]={
		0x65, 0x83, 0x2D, 0x7C, 0x7B, 0x27, 0x2E, 0x98, 0x57, 0xD1, 0x08, 0x4F, 0x3A, 0x75, 0x54, 0x0D, 
		0x40, 0xC2, 0x04, 0x23, 0x3A, 0x6A, 0x65, 0x6A, 0x15, 0x9D, 0x59, 0x52, 0x2D, 0x68, 0x4E, 0x3E
	};
	CK_BYTE     pub_x[32]={
		0xD6, 0xA7, 0x78, 0x8C, 0x41, 0xC3, 0xA3, 0x66, 0x18, 0xE8, 0x02, 0x1E, 0xE1, 0xEB, 0x27, 0x2F, 
		0xA7, 0x24, 0x7F, 0x77, 0xF4, 0x7F, 0x40, 0xBE, 0x6A, 0x31, 0x02, 0x48, 0x41, 0xA0, 0x14, 0xC6
	};
	CK_BYTE     pub_y[32]={
		0x39, 0xE2, 0xF0, 0xA4, 0x69, 0x22, 0xD3, 0x56, 0xBD, 0xB0, 0x39, 0x12, 0x26, 0xA9, 0xD1, 0x47, 
		0x40, 0x84, 0x3D, 0xFE, 0x57, 0x68, 0x0D, 0x28, 0x87, 0x44, 0xB7, 0xD8, 0x20, 0xE0, 0x32, 0xBB
	};

	CK_BYTE     temp_prv[32] = {
		0x3D, 0x73, 0x7C, 0x01, 0x52, 0x36, 0x79, 0xB0, 0x39, 0x95, 0x60, 0xD1, 0x27, 0x4E, 0x77, 0x7C, 
		0x59, 0xD0, 0x40, 0xBF, 0x28, 0x38, 0x0E, 0x33, 0x1F, 0xFA, 0x66, 0x79, 0x66, 0xF2, 0x02, 0x89};
	CK_BYTE     temp_pub_x[32] = {
		0x38, 0xCD, 0xAD, 0xDD, 0xDA, 0x1C, 0x6C, 0x51, 0x35, 0x23, 0xCC, 0xB3, 0x2E, 0x0E, 0x28, 0x01, 
		0x26, 0x2B, 0x7F, 0x95, 0xF2, 0x5E, 0x85, 0x3C, 0x86, 0xE1, 0x01, 0x28, 0x6C, 0x82, 0xD7, 0x18};
	CK_BYTE     temp_pub_y[32] = {
		0x6A, 0x1C, 0x8A, 0x61, 0xC4, 0xD3, 0xED, 0x61, 0x9D, 0xFA, 0xA0, 0x33, 0x20, 0x5C, 0x5F, 0x76, 
		0x9B, 0x3B, 0xE1, 0x2C, 0x8F, 0x15, 0x7C, 0x2F, 0x55, 0x75, 0xFF, 0xEE, 0xFB, 0x42, 0xA0, 0x64};

	CK_KEY_TYPE  keyType=CKK_ECC;
	CK_OBJECT_CLASS pubclass=CKO_PUBLIC_KEY,priclass=CKO_PRIVATE_KEY;
	CK_UINT     modulusBits = 256;

	CK_BYTE      id[] = {0x01,0x01,0x02,0x03};

	CK_ATTRIBUTE publicKeyTemplate[] = {		
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &pubclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_PRIVATE, &ttrue, sizeof(ttrue)},
		{CKA_ENCRYPT, &ttrue, sizeof(ttrue)},
		{CKA_VERIFY, &ttrue, sizeof(ttrue)},
		{CKA_KEY_TYPE,&keyType,sizeof(keyType)},
		{CKA_ECC_BITS_LEN, &modulusBits, sizeof(CK_UINT)},
		{CKA_ECC_X_COORDINATE, pub_x, sizeof(temp_pub_x)},
		{CKA_ECC_Y_COORDINATE, pub_y, sizeof(temp_pub_y)},
		{CKA_ID, id, sizeof(id)}
	};

	CK_ATTRIBUTE privateKeyTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &priclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_PRIVATE, &ttrue, sizeof(ttrue)},
		{CKA_DECRYPT, &ttrue, sizeof(ttrue)},
		{CKA_SIGN, &ttrue, sizeof(ttrue)},
		{CKA_KEY_TYPE,&keyType,sizeof(keyType)},
		{CKA_ECC_BITS_LEN, &modulusBits, sizeof(CK_UINT)},
		{CKA_ECC_PRIVATE, prv, sizeof(temp_prv)},
		{CKA_ID, id, sizeof(id)}
	};

	//有效证书的value
	CK_BYTE cert[]={0x30,0x82,0x05,0x6D,0x30,0x82,0x04,0x55,0xA0,0x03,0x02,0x01,0x02,0x02,0x0A,0x22,
		0x09,0x63,0xB1,0x00,0x00,0x00,0x00,0x64,0x45,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,
		0x86,0xF7,0x0D,0x01,0x01,0x05,0x05,0x00,0x30,0x3E,0x31,0x13,0x30,0x11,0x06,0x0A,
		0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,0x03,0x63,0x6F,0x6D,0x31,
		0x18,0x30,0x16,0x06,0x0A,0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,
		0x08,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x31,0x0D,0x30,0x0B,0x06,0x03,0x55,
		0x04,0x03,0x13,0x04,0x42,0x4A,0x49,0x53,0x30,0x1E,0x17,0x0D,0x31,0x33,0x30,0x36,
		0x30,0x34,0x30,0x35,0x34,0x38,0x32,0x33,0x5A,0x17,0x0D,0x31,0x34,0x30,0x36,0x30,
		0x34,0x30,0x35,0x34,0x38,0x32,0x33,0x5A,0x30,0x58,0x31,0x13,0x30,0x11,0x06,0x0A,
		0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,0x03,0x63,0x6F,0x6D,0x31,
		0x18,0x30,0x16,0x06,0x0A,0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,
		0x08,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x31,0x18,0x30,0x16,0x06,0x03,0x55,
		0x04,0x0B,0x0C,0x0F,0x44,0x65,0x70,0x61,0x72,0x74,0x5F,0x69,0x6E,0x66,0x6F,0x74,
		0x65,0x63,0x68,0x31,0x0D,0x30,0x0B,0x06,0x03,0x55,0x04,0x03,0x13,0x04,0x74,0x65,
		0x73,0x74,0x30,0x81,0x9F,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,
		0x01,0x01,0x05,0x00,0x03,0x81,0x8D,0x00,0x30,0x81,0x89,0x02,0x81,0x81,0x00,0xBC,
		0x13,0x01,0xAE,0xF2,0x5F,0x39,0x5A,0xF2,0xB2,0x95,0xC3,0xD1,0x04,0x64,0x60,0x09,
		0xAA,0xAB,0x8B,0xA2,0x8F,0x00,0x4A,0x94,0x71,0x93,0xD9,0xD9,0xCA,0x39,0xAA,0xE9,
		0x6E,0xED,0xAE,0xA9,0x87,0x29,0x22,0xB3,0x52,0x40,0x2B,0xDE,0xC3,0x6F,0x0D,0x8B,
		0xDD,0x74,0x89,0xE0,0x82,0xD1,0xDB,0x7F,0x8E,0xD0,0x8E,0x66,0x5A,0x2C,0x80,0x2C,
		0xCF,0xEB,0x31,0x77,0x54,0xC8,0x16,0xBA,0xE9,0x76,0x56,0x89,0x52,0xA1,0x09,0xA3,
		0xBA,0xC7,0x0E,0x3F,0xF9,0xBE,0x7C,0x1A,0xA7,0x3B,0xC0,0xFF,0x60,0x40,0x1A,0xCE,
		0xA0,0x1A,0xF1,0xD6,0x33,0xF2,0xBD,0xB3,0x0F,0x30,0x39,0x1D,0x25,0xC2,0xDF,0xA5,
		0x58,0xE7,0xD4,0x69,0x79,0xAC,0x3B,0x0D,0xDF,0x1C,0xAD,0xC1,0x9E,0xA3,0x6D,0x02,
		0x03,0x01,0x00,0x01,0xA3,0x82,0x02,0xD5,0x30,0x82,0x02,0xD1,0x30,0x0B,0x06,0x03,
		0x55,0x1D,0x0F,0x04,0x04,0x03,0x02,0x05,0xA0,0x30,0x1D,0x06,0x03,0x55,0x1D,0x0E,
		0x04,0x16,0x04,0x14,0x39,0x6B,0x69,0x14,0x6F,0x73,0x4B,0x5B,0xC9,0xDE,0x86,0x9D,
		0xC1,0x25,0xF8,0x12,0x5B,0x4A,0x34,0x8F,0x30,0x2B,0x06,0x09,0x2B,0x06,0x01,0x04,
		0x01,0x82,0x37,0x14,0x02,0x04,0x1E,0x1E,0x1C,0x00,0x53,0x00,0x6D,0x00,0x61,0x00,
		0x72,0x00,0x74,0x00,0x63,0x00,0x61,0x00,0x72,0x00,0x64,0x00,0x4C,0x00,0x6F,0x00,
		0x67,0x00,0x6F,0x00,0x6E,0x30,0x1F,0x06,0x03,0x55,0x1D,0x23,0x04,0x18,0x30,0x16,
		0x80,0x14,0xC8,0x7A,0xC5,0x17,0x08,0x7F,0x56,0x4D,0x5A,0x45,0xBE,0x6B,0x71,0x09,
		0xD0,0x05,0xDE,0x6F,0x5B,0x04,0x30,0x81,0xF6,0x06,0x03,0x55,0x1D,0x1F,0x04,0x81,
		0xEE,0x30,0x81,0xEB,0x30,0x81,0xE8,0xA0,0x81,0xE5,0xA0,0x81,0xE2,0x86,0x81,0xAD,
		0x6C,0x64,0x61,0x70,0x3A,0x2F,0x2F,0x2F,0x43,0x4E,0x3D,0x42,0x4A,0x49,0x53,0x2C,
		0x43,0x4E,0x3D,0x53,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2C,0x43,0x4E,0x3D,0x43,
		0x44,0x50,0x2C,0x43,0x4E,0x3D,0x50,0x75,0x62,0x6C,0x69,0x63,0x25,0x32,0x30,0x4B,
		0x65,0x79,0x25,0x32,0x30,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,
		0x3D,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,0x3D,0x43,0x6F,0x6E,
		0x66,0x69,0x67,0x75,0x72,0x61,0x74,0x69,0x6F,0x6E,0x2C,0x44,0x43,0x3D,0x4D,0x69,
		0x63,0x72,0x6F,0x53,0x65,0x63,0x2C,0x44,0x43,0x3D,0x63,0x6F,0x6D,0x3F,0x63,0x65,
		0x72,0x74,0x69,0x66,0x69,0x63,0x61,0x74,0x65,0x52,0x65,0x76,0x6F,0x63,0x61,0x74,
		0x69,0x6F,0x6E,0x4C,0x69,0x73,0x74,0x3F,0x62,0x61,0x73,0x65,0x3F,0x6F,0x62,0x6A,
		0x65,0x63,0x74,0x43,0x6C,0x61,0x73,0x73,0x3D,0x63,0x52,0x4C,0x44,0x69,0x73,0x74,
		0x72,0x69,0x62,0x75,0x74,0x69,0x6F,0x6E,0x50,0x6F,0x69,0x6E,0x74,0x86,0x30,0x68,
		0x74,0x74,0x70,0x3A,0x2F,0x2F,0x73,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x6D,
		0x69,0x63,0x72,0x6F,0x73,0x65,0x63,0x2E,0x63,0x6F,0x6D,0x2F,0x43,0x65,0x72,0x74,
		0x45,0x6E,0x72,0x6F,0x6C,0x6C,0x2F,0x42,0x4A,0x49,0x53,0x2E,0x63,0x72,0x6C,0x30,
		0x82,0x01,0x0B,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,0x07,0x01,0x01,0x04,0x81,0xFE,
		0x30,0x81,0xFB,0x30,0x81,0xA4,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,0x07,0x30,0x02,
		0x86,0x81,0x97,0x6C,0x64,0x61,0x70,0x3A,0x2F,0x2F,0x2F,0x43,0x4E,0x3D,0x42,0x4A,
		0x49,0x53,0x2C,0x43,0x4E,0x3D,0x41,0x49,0x41,0x2C,0x43,0x4E,0x3D,0x50,0x75,0x62,
		0x6C,0x69,0x63,0x25,0x32,0x30,0x4B,0x65,0x79,0x25,0x32,0x30,0x53,0x65,0x72,0x76,
		0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,0x3D,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,
		0x2C,0x43,0x4E,0x3D,0x43,0x6F,0x6E,0x66,0x69,0x67,0x75,0x72,0x61,0x74,0x69,0x6F,
		0x6E,0x2C,0x44,0x43,0x3D,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x2C,0x44,0x43,
		0x3D,0x63,0x6F,0x6D,0x3F,0x63,0x41,0x43,0x65,0x72,0x74,0x69,0x66,0x69,0x63,0x61,
		0x74,0x65,0x3F,0x62,0x61,0x73,0x65,0x3F,0x6F,0x62,0x6A,0x65,0x63,0x74,0x43,0x6C,
		0x61,0x73,0x73,0x3D,0x63,0x65,0x72,0x74,0x69,0x66,0x69,0x63,0x61,0x74,0x69,0x6F,
		0x6E,0x41,0x75,0x74,0x68,0x6F,0x72,0x69,0x74,0x79,0x30,0x52,0x06,0x08,0x2B,0x06,
		0x01,0x05,0x05,0x07,0x30,0x02,0x86,0x46,0x68,0x74,0x74,0x70,0x3A,0x2F,0x2F,0x73,
		0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x6D,0x69,0x63,0x72,0x6F,0x73,0x65,0x63,
		0x2E,0x63,0x6F,0x6D,0x2F,0x43,0x65,0x72,0x74,0x45,0x6E,0x72,0x6F,0x6C,0x6C,0x2F,
		0x53,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,
		0x63,0x2E,0x63,0x6F,0x6D,0x5F,0x42,0x4A,0x49,0x53,0x2E,0x63,0x72,0x74,0x30,0x1F,
		0x06,0x03,0x55,0x1D,0x25,0x04,0x18,0x30,0x16,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,
		0x07,0x03,0x02,0x06,0x0A,0x2B,0x06,0x01,0x04,0x01,0x82,0x37,0x14,0x02,0x02,0x30,
		0x2C,0x06,0x03,0x55,0x1D,0x11,0x04,0x25,0x30,0x23,0xA0,0x21,0x06,0x0A,0x2B,0x06,
		0x01,0x04,0x01,0x82,0x37,0x14,0x02,0x03,0xA0,0x13,0x0C,0x11,0x74,0x65,0x73,0x74,
		0x40,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x2E,0x63,0x6F,0x6D,0x30,0x0D,0x06,
		0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,0x01,0x05,0x05,0x00,0x03,0x82,0x01,0x01,
		0x00,0x79,0x84,0x2F,0x6E,0x39,0x9C,0x0A,0xC8,0xDE,0x9E,0x2B,0xEA,0x5D,0xD4,0x88,
		0x04,0x98,0xFA,0x60,0x90,0x9E,0xEA,0xBC,0xBE,0x95,0xAB,0x3E,0xA8,0x52,0xF6,0x96,
		0x65,0x7B,0x1A,0x5A,0x46,0x0D,0x3A,0x12,0xE1,0x4F,0x8F,0xF8,0xDE,0xB6,0x5F,0x88,
		0xBF,0xDB,0xEF,0x08,0x11,0x16,0x9E,0xCA,0x35,0x4A,0xE6,0x76,0xA9,0x87,0xD5,0x5B,
		0x3D,0x7D,0x8F,0x9B,0x14,0xA4,0x69,0x6F,0x1F,0xEC,0xB7,0x36,0x8D,0xD2,0x04,0xF4,
		0x0D,0x70,0x4E,0xE8,0xF0,0xF2,0xDA,0x4E,0x8C,0x8F,0x12,0xF5,0x29,0x4A,0xC1,0x25,
		0x26,0x3E,0x7A,0x26,0x5E,0x78,0x6B,0x5D,0xED,0x14,0x57,0xDA,0x01,0xC7,0x36,0xCD,
		0xD1,0xA9,0xC9,0x53,0x4F,0xB2,0xDD,0xB1,0xB0,0x11,0x05,0x57,0xFA,0x75,0x7C,0x24,
		0x81,0xD1,0xEF,0xE2,0x1D,0x5B,0x59,0x9B,0x4C,0x14,0x6C,0x4E,0x6D,0xEF,0xDB,0x20,
		0x75,0x7A,0x96,0x81,0x46,0xA6,0x13,0xC5,0xD5,0x69,0x45,0x32,0xE7,0x3F,0x24,0x48,
		0x6A,0xCF,0xA5,0x5A,0x20,0x8C,0x43,0xF3,0xDB,0x66,0x6E,0x45,0x2B,0x5D,0x3A,0x5C,
		0x4E,0xA5,0x5F,0x09,0x70,0xBF,0xF5,0x6A,0x3A,0xA9,0xCA,0x4C,0x2D,0x93,0x3C,0x6C,
		0xB3,0xFA,0xA4,0x2F,0x8F,0x75,0x97,0xD2,0x85,0xF4,0x51,0x18,0x38,0x48,0xE7,0xEA,
		0x89,0x66,0x55,0x26,0x28,0x30,0x7F,0xA4,0x3F,0xE9,0xC7,0x99,0xAA,0x41,0x2B,0xEC,
		0x2B,0x17,0x3B,0x33,0x1E,0xCA,0xFD,0xF5,0x19,0xD4,0xF3,0xBD,0x7F,0xEE,0x65,0x03,
		0xB7,0xDD,0xBC,0x95,0x2D,0xDA,0x58,0x95,0x99,0x25,0x84,0xEC,0xC5,0xE0,0xE6,0x29,
		0x7E};
	CK_OBJECT_CLASS certclass=CKO_CERTIFICATE;
	CK_CERTIFICATE_TYPE certtype=CKC_X_509;
	CK_BYTE subject[] = {'s','u','b','j','e','c','t'};
	CK_BYTE issuer[] = {'i','s','s','u','e','r'};
	CK_BYTE SN[] = {'1','2','3','4','5','6'};
	CK_ATTRIBUTE certTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &certclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_CERTIFICATE_TYPE, &certtype, sizeof(CK_CERTIFICATE_TYPE)},
		{CKA_SUBJECT, subject, sizeof(subject)},
		{CKA_ISSUER,  issuer, sizeof(issuer)},
		{CKA_SERIAL_NUMBER, SN, sizeof(SN)},
		{CKA_VALUE, cert, sizeof(cert)}
	};

	for (i=0; i<iMaxCount; i++)
	{
		//创建公钥对象
		rv = (*pC_CreateObject)(hSession, 
			publicKeyTemplate, sizeof(publicKeyTemplate)/sizeof(CK_ATTRIBUTE),
			&hPublicKey);
		if(rv!=CKR_OK)
		{
			printf("test_object_max_count failed,pC_CreateObject,0. rv=0x%08x.\n",rv);
			goto END;
		}
		printf("C_CreateObject, public key object %d ok.\n", i);

		//创建私钥对象
		rv = (*pC_CreateObject)(hSession, 
			privateKeyTemplate, sizeof(privateKeyTemplate)/sizeof(CK_ATTRIBUTE),
			&hPrivateKey);
		if(rv!=CKR_OK)
		{
			printf("test_object_max_count failed,pC_CreateObject,1. rv=0x%08x.\n",rv);
			goto END;
		}
		printf("C_CreateObject, private key object %d ok.\n", i);

		//创建证书对象
		rv = (*pC_CreateObject)(hSession, 
			certTemplate, sizeof(certTemplate)/sizeof(CK_ATTRIBUTE),
			&hCertificate);
		if(rv!=CKR_OK)
		{
			printf("test_object_max_count failed,pC_CreateObject,2. rv=0x%08x.\n",rv);
			goto END;
		}
		printf("C_CreateObject, certificate object %d ok.\n", i);
	}
	

	bRtn = true;
END:
	printf("leave test_object_max_count.\n");

	return bRtn;
}

bool test_object_cert()
{
	bool	bRtn = false;

	CK_BBOOL ttrue = CK_TRUE;
	CK_BBOOL ffalse = CK_FALSE;

	CK_RV	rv = 0;
	CK_OBJECT_HANDLE hCertificate = NULL_PTR;

	CK_OBJECT_HANDLE hObject[16] = {0};
	CK_ULONG i = 0, j = 0, k = 0, ulObjectCount = 0, ulReadTime = 100;

		UtilscTime ttc1={0, 0},ttc2={0,0},ttc3={0,0},ttc4={0,0};

	printf("enter test_object_cert.\n");

	//有效证书的value
	CK_BYTE cert[1393]={0x30,0x82,0x05,0x6D,0x30,0x82,0x04,0x55,0xA0,0x03,0x02,0x01,0x02,0x02,0x0A,0x22,
		0x09,0x63,0xB1,0x00,0x00,0x00,0x00,0x64,0x45,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,
		0x86,0xF7,0x0D,0x01,0x01,0x05,0x05,0x00,0x30,0x3E,0x31,0x13,0x30,0x11,0x06,0x0A,
		0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,0x03,0x63,0x6F,0x6D,0x31,
		0x18,0x30,0x16,0x06,0x0A,0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,
		0x08,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x31,0x0D,0x30,0x0B,0x06,0x03,0x55,
		0x04,0x03,0x13,0x04,0x42,0x4A,0x49,0x53,0x30,0x1E,0x17,0x0D,0x31,0x33,0x30,0x36,
		0x30,0x34,0x30,0x35,0x34,0x38,0x32,0x33,0x5A,0x17,0x0D,0x31,0x34,0x30,0x36,0x30,
		0x34,0x30,0x35,0x34,0x38,0x32,0x33,0x5A,0x30,0x58,0x31,0x13,0x30,0x11,0x06,0x0A,
		0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,0x03,0x63,0x6F,0x6D,0x31,
		0x18,0x30,0x16,0x06,0x0A,0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,
		0x08,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x31,0x18,0x30,0x16,0x06,0x03,0x55,
		0x04,0x0B,0x0C,0x0F,0x44,0x65,0x70,0x61,0x72,0x74,0x5F,0x69,0x6E,0x66,0x6F,0x74,
		0x65,0x63,0x68,0x31,0x0D,0x30,0x0B,0x06,0x03,0x55,0x04,0x03,0x13,0x04,0x74,0x65,
		0x73,0x74,0x30,0x81,0x9F,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,
		0x01,0x01,0x05,0x00,0x03,0x81,0x8D,0x00,0x30,0x81,0x89,0x02,0x81,0x81,0x00,0xBC,
		0x13,0x01,0xAE,0xF2,0x5F,0x39,0x5A,0xF2,0xB2,0x95,0xC3,0xD1,0x04,0x64,0x60,0x09,
		0xAA,0xAB,0x8B,0xA2,0x8F,0x00,0x4A,0x94,0x71,0x93,0xD9,0xD9,0xCA,0x39,0xAA,0xE9,
		0x6E,0xED,0xAE,0xA9,0x87,0x29,0x22,0xB3,0x52,0x40,0x2B,0xDE,0xC3,0x6F,0x0D,0x8B,
		0xDD,0x74,0x89,0xE0,0x82,0xD1,0xDB,0x7F,0x8E,0xD0,0x8E,0x66,0x5A,0x2C,0x80,0x2C,
		0xCF,0xEB,0x31,0x77,0x54,0xC8,0x16,0xBA,0xE9,0x76,0x56,0x89,0x52,0xA1,0x09,0xA3,
		0xBA,0xC7,0x0E,0x3F,0xF9,0xBE,0x7C,0x1A,0xA7,0x3B,0xC0,0xFF,0x60,0x40,0x1A,0xCE,
		0xA0,0x1A,0xF1,0xD6,0x33,0xF2,0xBD,0xB3,0x0F,0x30,0x39,0x1D,0x25,0xC2,0xDF,0xA5,
		0x58,0xE7,0xD4,0x69,0x79,0xAC,0x3B,0x0D,0xDF,0x1C,0xAD,0xC1,0x9E,0xA3,0x6D,0x02,
		0x03,0x01,0x00,0x01,0xA3,0x82,0x02,0xD5,0x30,0x82,0x02,0xD1,0x30,0x0B,0x06,0x03,
		0x55,0x1D,0x0F,0x04,0x04,0x03,0x02,0x05,0xA0,0x30,0x1D,0x06,0x03,0x55,0x1D,0x0E,
		0x04,0x16,0x04,0x14,0x39,0x6B,0x69,0x14,0x6F,0x73,0x4B,0x5B,0xC9,0xDE,0x86,0x9D,
		0xC1,0x25,0xF8,0x12,0x5B,0x4A,0x34,0x8F,0x30,0x2B,0x06,0x09,0x2B,0x06,0x01,0x04,
		0x01,0x82,0x37,0x14,0x02,0x04,0x1E,0x1E,0x1C,0x00,0x53,0x00,0x6D,0x00,0x61,0x00,
		0x72,0x00,0x74,0x00,0x63,0x00,0x61,0x00,0x72,0x00,0x64,0x00,0x4C,0x00,0x6F,0x00,
		0x67,0x00,0x6F,0x00,0x6E,0x30,0x1F,0x06,0x03,0x55,0x1D,0x23,0x04,0x18,0x30,0x16,
		0x80,0x14,0xC8,0x7A,0xC5,0x17,0x08,0x7F,0x56,0x4D,0x5A,0x45,0xBE,0x6B,0x71,0x09,
		0xD0,0x05,0xDE,0x6F,0x5B,0x04,0x30,0x81,0xF6,0x06,0x03,0x55,0x1D,0x1F,0x04,0x81,
		0xEE,0x30,0x81,0xEB,0x30,0x81,0xE8,0xA0,0x81,0xE5,0xA0,0x81,0xE2,0x86,0x81,0xAD,
		0x6C,0x64,0x61,0x70,0x3A,0x2F,0x2F,0x2F,0x43,0x4E,0x3D,0x42,0x4A,0x49,0x53,0x2C,
		0x43,0x4E,0x3D,0x53,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2C,0x43,0x4E,0x3D,0x43,
		0x44,0x50,0x2C,0x43,0x4E,0x3D,0x50,0x75,0x62,0x6C,0x69,0x63,0x25,0x32,0x30,0x4B,
		0x65,0x79,0x25,0x32,0x30,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,
		0x3D,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,0x3D,0x43,0x6F,0x6E,
		0x66,0x69,0x67,0x75,0x72,0x61,0x74,0x69,0x6F,0x6E,0x2C,0x44,0x43,0x3D,0x4D,0x69,
		0x63,0x72,0x6F,0x53,0x65,0x63,0x2C,0x44,0x43,0x3D,0x63,0x6F,0x6D,0x3F,0x63,0x65,
		0x72,0x74,0x69,0x66,0x69,0x63,0x61,0x74,0x65,0x52,0x65,0x76,0x6F,0x63,0x61,0x74,
		0x69,0x6F,0x6E,0x4C,0x69,0x73,0x74,0x3F,0x62,0x61,0x73,0x65,0x3F,0x6F,0x62,0x6A,
		0x65,0x63,0x74,0x43,0x6C,0x61,0x73,0x73,0x3D,0x63,0x52,0x4C,0x44,0x69,0x73,0x74,
		0x72,0x69,0x62,0x75,0x74,0x69,0x6F,0x6E,0x50,0x6F,0x69,0x6E,0x74,0x86,0x30,0x68,
		0x74,0x74,0x70,0x3A,0x2F,0x2F,0x73,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x6D,
		0x69,0x63,0x72,0x6F,0x73,0x65,0x63,0x2E,0x63,0x6F,0x6D,0x2F,0x43,0x65,0x72,0x74,
		0x45,0x6E,0x72,0x6F,0x6C,0x6C,0x2F,0x42,0x4A,0x49,0x53,0x2E,0x63,0x72,0x6C,0x30,
		0x82,0x01,0x0B,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,0x07,0x01,0x01,0x04,0x81,0xFE,
		0x30,0x81,0xFB,0x30,0x81,0xA4,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,0x07,0x30,0x02,
		0x86,0x81,0x97,0x6C,0x64,0x61,0x70,0x3A,0x2F,0x2F,0x2F,0x43,0x4E,0x3D,0x42,0x4A,
		0x49,0x53,0x2C,0x43,0x4E,0x3D,0x41,0x49,0x41,0x2C,0x43,0x4E,0x3D,0x50,0x75,0x62,
		0x6C,0x69,0x63,0x25,0x32,0x30,0x4B,0x65,0x79,0x25,0x32,0x30,0x53,0x65,0x72,0x76,
		0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,0x3D,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,
		0x2C,0x43,0x4E,0x3D,0x43,0x6F,0x6E,0x66,0x69,0x67,0x75,0x72,0x61,0x74,0x69,0x6F,
		0x6E,0x2C,0x44,0x43,0x3D,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x2C,0x44,0x43,
		0x3D,0x63,0x6F,0x6D,0x3F,0x63,0x41,0x43,0x65,0x72,0x74,0x69,0x66,0x69,0x63,0x61,
		0x74,0x65,0x3F,0x62,0x61,0x73,0x65,0x3F,0x6F,0x62,0x6A,0x65,0x63,0x74,0x43,0x6C,
		0x61,0x73,0x73,0x3D,0x63,0x65,0x72,0x74,0x69,0x66,0x69,0x63,0x61,0x74,0x69,0x6F,
		0x6E,0x41,0x75,0x74,0x68,0x6F,0x72,0x69,0x74,0x79,0x30,0x52,0x06,0x08,0x2B,0x06,
		0x01,0x05,0x05,0x07,0x30,0x02,0x86,0x46,0x68,0x74,0x74,0x70,0x3A,0x2F,0x2F,0x73,
		0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x6D,0x69,0x63,0x72,0x6F,0x73,0x65,0x63,
		0x2E,0x63,0x6F,0x6D,0x2F,0x43,0x65,0x72,0x74,0x45,0x6E,0x72,0x6F,0x6C,0x6C,0x2F,
		0x53,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,
		0x63,0x2E,0x63,0x6F,0x6D,0x5F,0x42,0x4A,0x49,0x53,0x2E,0x63,0x72,0x74,0x30,0x1F,
		0x06,0x03,0x55,0x1D,0x25,0x04,0x18,0x30,0x16,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,
		0x07,0x03,0x02,0x06,0x0A,0x2B,0x06,0x01,0x04,0x01,0x82,0x37,0x14,0x02,0x02,0x30,
		0x2C,0x06,0x03,0x55,0x1D,0x11,0x04,0x25,0x30,0x23,0xA0,0x21,0x06,0x0A,0x2B,0x06,
		0x01,0x04,0x01,0x82,0x37,0x14,0x02,0x03,0xA0,0x13,0x0C,0x11,0x74,0x65,0x73,0x74,
		0x40,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x2E,0x63,0x6F,0x6D,0x30,0x0D,0x06,
		0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,0x01,0x05,0x05,0x00,0x03,0x82,0x01,0x01,
		0x00,0x79,0x84,0x2F,0x6E,0x39,0x9C,0x0A,0xC8,0xDE,0x9E,0x2B,0xEA,0x5D,0xD4,0x88,
		0x04,0x98,0xFA,0x60,0x90,0x9E,0xEA,0xBC,0xBE,0x95,0xAB,0x3E,0xA8,0x52,0xF6,0x96,
		0x65,0x7B,0x1A,0x5A,0x46,0x0D,0x3A,0x12,0xE1,0x4F,0x8F,0xF8,0xDE,0xB6,0x5F,0x88,
		0xBF,0xDB,0xEF,0x08,0x11,0x16,0x9E,0xCA,0x35,0x4A,0xE6,0x76,0xA9,0x87,0xD5,0x5B,
		0x3D,0x7D,0x8F,0x9B,0x14,0xA4,0x69,0x6F,0x1F,0xEC,0xB7,0x36,0x8D,0xD2,0x04,0xF4,
		0x0D,0x70,0x4E,0xE8,0xF0,0xF2,0xDA,0x4E,0x8C,0x8F,0x12,0xF5,0x29,0x4A,0xC1,0x25,
		0x26,0x3E,0x7A,0x26,0x5E,0x78,0x6B,0x5D,0xED,0x14,0x57,0xDA,0x01,0xC7,0x36,0xCD,
		0xD1,0xA9,0xC9,0x53,0x4F,0xB2,0xDD,0xB1,0xB0,0x11,0x05,0x57,0xFA,0x75,0x7C,0x24,
		0x81,0xD1,0xEF,0xE2,0x1D,0x5B,0x59,0x9B,0x4C,0x14,0x6C,0x4E,0x6D,0xEF,0xDB,0x20,
		0x75,0x7A,0x96,0x81,0x46,0xA6,0x13,0xC5,0xD5,0x69,0x45,0x32,0xE7,0x3F,0x24,0x48,
		0x6A,0xCF,0xA5,0x5A,0x20,0x8C,0x43,0xF3,0xDB,0x66,0x6E,0x45,0x2B,0x5D,0x3A,0x5C,
		0x4E,0xA5,0x5F,0x09,0x70,0xBF,0xF5,0x6A,0x3A,0xA9,0xCA,0x4C,0x2D,0x93,0x3C,0x6C,
		0xB3,0xFA,0xA4,0x2F,0x8F,0x75,0x97,0xD2,0x85,0xF4,0x51,0x18,0x38,0x48,0xE7,0xEA,
		0x89,0x66,0x55,0x26,0x28,0x30,0x7F,0xA4,0x3F,0xE9,0xC7,0x99,0xAA,0x41,0x2B,0xEC,
		0x2B,0x17,0x3B,0x33,0x1E,0xCA,0xFD,0xF5,0x19,0xD4,0xF3,0xBD,0x7F,0xEE,0x65,0x03,
		0xB7,0xDD,0xBC,0x95,0x2D,0xDA,0x58,0x95,0x99,0x25,0x84,0xEC,0xC5,0xE0,0xE6,0x29,
		0x7E};
	CK_OBJECT_CLASS certclass = CKO_CERTIFICATE;
	CK_CERTIFICATE_TYPE certtype = CKC_X_509;
	CK_BYTE subject[] = {'s','u','b','j','e','c','t'};
	CK_BYTE issuer[] = {'i','s','s','u','e','r'};
	CK_BYTE SN[] = {'1','2','3','4','5','6'};

	CK_ATTRIBUTE_TYPE cko_class = CKO_DATA;

	//CK_ATTRIBUTE certTemplate[] = {
	//{ CKA_APPLICATION, subject, sizeof(subject) },
	//{ CKA_LABEL, issuer, sizeof(issuer)},
	//{ CKA_VALUE, cert, sizeof(cert) },
	//{ CKA_CLASS, &cko_class, sizeof(CK_ATTRIBUTE_TYPE)},
	//{ CKA_TOKEN, &ttrue, sizeof(CK_BBOOL) },
	//{ CKA_PRIVATE, &ttrue, sizeof(CK_BBOOL) } 
	//};

	CK_ATTRIBUTE certTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &certclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_CERTIFICATE_TYPE, &certtype, sizeof(CK_CERTIFICATE_TYPE)},
		//{CKA_SUBJECT, subject, sizeof(subject)},
		//{CKA_ISSUER,  issuer, sizeof(issuer)},
		//{CKA_SERIAL_NUMBER, SN, sizeof(SN)},
		{CKA_VALUE, cert, sizeof(cert)},
		{CKA_LABEL, issuer, sizeof(issuer)}
		//{CKA_LOCATION_ATTRIBUTES, }
	};

	CK_ATTRIBUTE certfindtemplate[] = {
		{CKA_CLASS, &certclass, sizeof(CK_OBJECT_CLASS)},
		//{ CKA_CLASS, &cko_class, sizeof(CK_ATTRIBUTE_TYPE)},
		//{CKA_SUBJECT, subject, sizeof(subject)},
		//{CKA_APPLICATION, subject, sizeof(subject)}
		{CKA_LABEL, issuer, sizeof(issuer)}
	};

	CK_ATTRIBUTE template_get[] = {
		{CKA_VALUE, NULL, 0}
	};
	//rv=pC_Monopolize_Enable();
	//if(rv!=CKR_OK)
	//{
	//	printf("test_object_cert failed,pC_FindObjectsInit0. rv=0x%08x. i=%d.\n",rv,i);
	//	printf("after pC_FindObjectsInit0 failed sleep\n");
	//	sleep(30);
	//	goto END;
	//}
#if 1
	//查找证书对象
	rv = pC_FindObjectsInit(hSession, certfindtemplate, sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE));
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsInit0. rv=0x%08x. i=%d.\n",rv,i);
		printf("after pC_FindObjectsInit0 failed sleep\n");
		sleep(30);
		goto END;
	}

	//printf("111\n");
	//rv = pC_CloseSession(hSession);
	//if(rv!=CKR_OK)
	//{
	//	printf("test_object_cert failed,pC_CloseSession. rv=0x%08x. i=%d.\n",rv,i);
	//	goto END;
	//}
	//printf("222\n");
	//printf("after pC_FindObjectsInit0 ok sleep\n");
	//sleep(30);
#endif
	ulObjectCount = sizeof(hObject) / sizeof(CK_OBJECT_HANDLE);
	rv = pC_FindObjects(hSession, hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	rv = pC_FindObjectsFinal(hSession);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	printf(" C_FindObjects count %d.\n",ulObjectCount);


	//printf("before pC_FindObjectsInit sleep\n");
	//sleep(30);
	//查找证书对象
	rv = pC_FindObjectsInit(hSession, certfindtemplate, sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE));
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsInit. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	ulObjectCount = sizeof(hObject) / sizeof(CK_OBJECT_HANDLE);
	rv = pC_FindObjects(hSession, hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	rv = pC_FindObjectsFinal(hSession);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	printf(" C_FindObjects count %d.\n",ulObjectCount);



	for (i=0; i<ulObjectCount; i++)
	{
		printf("Cert i=%d,CertObject=0x%08x.\n",i,hObject[i]);
		//nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"Cert i=%d,CertObject=0x%08x.\n",i,hObjectDestory);

		rv = (*pC_DestroyObject)(hSession, hObject[i]);
		if(rv!=CKR_OK)
		{
			printf("test_FindCertObjectNumberfailed, pC_DestroyCertObject. rv=0x%08x.\n",rv);
			//nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"test_FindCertObjectNumberfailed, pC_DestroyCertObject. rv=0x%08x.\n",rv);	
			return false;

		}
		else
		{
			printf("Destroy Cert=0x%08x Success.\n",hObject[i]);
			//nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"Destroy KeyObject=0x%08x Success.\n",hObjectDestory);	

		}
	}


	//创建证书对象
	rv = (*pC_CreateObject)(hSession, 
		certTemplate, sizeof(certTemplate)/sizeof(CK_ATTRIBUTE),
		&hCertificate);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_CreateObject. rv=0x%08x.\n",rv);
		goto END;
	}

	///////////////////////////////////////////////////
	//printf("before pC_FindObjectsInit sleep\n");
	//sleep(30);
	//查找证书对象
	rv = pC_FindObjectsInit(hSession, certfindtemplate, sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE));
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsInit. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	ulObjectCount = sizeof(hObject) / sizeof(CK_OBJECT_HANDLE);
	rv = pC_FindObjects(hSession, hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	rv = pC_FindObjectsFinal(hSession);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	printf(" C_FindObjects count %d.\n",ulObjectCount);
	////////////////////////////////////////////////////////////


	for (k=0; k<ulReadTime; k++)
	{

		//if(k==0)
		//{
			//查找证书对象
		
			rv = pC_FindObjectsInit(hSession, certfindtemplate, sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE));
			if(rv!=CKR_OK)
			{
				printf("test_object_cert failed,pC_FindObjectsInit. rv=0x%08x. i=%d.\n",rv,i);
				goto END;
			}

			ulObjectCount = sizeof(hObject) / sizeof(CK_OBJECT_HANDLE);
			rv = pC_FindObjects(hSession, hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
			if((rv!=CKR_OK) || (ulObjectCount==0))
			{
				printf("test_object_cert failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
				goto END;
			}

			rv = pC_FindObjectsFinal(hSession);
			if(rv!=CKR_OK)
			{
				printf("test_object_cert failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
				goto END;
			}

			Utilsgettime(&ttc2);
			UtilsTimeSubstracted(&ttc2,&ttc1);
			UtilsTimeAdded(&ttc3,&ttc2);

			printf(" C_FindObjects count %d.\n",ulObjectCount);

		//}
		
		//获取证书的值
		for (i=0; i<ulObjectCount; i++)
		{
			rv=pC_GetAttributeValue(hSession, hObject[i], template_get, sizeof(template_get)/sizeof(template_get[0]));
			if(rv!=CKR_OK)
			{
				printf("test_object_cert failed,pC_GetAttributeValue failed. rv=0x%x.\n",rv);
				goto END;
			}

			for(j=0; j<sizeof(template_get)/sizeof(template_get[0]); j++)
			{
				template_get[j].pValue=(CK_VOID_PTR)malloc(template_get[j].ulValueLen);
				if(template_get[j].pValue==NULL)
				{
					printf(" pC_GetAttributeValue memory out.\n");
				}
				memset(template_get[j].pValue, 0, template_get[j].ulValueLen);
			}

			rv=pC_GetAttributeValue(hSession, hObject[i], template_get,sizeof(template_get)/sizeof(template_get[0]));
			if(rv!=CKR_OK)
			{
				printf(" pC_GetAttributeValue failed 2. rv=0x%x.\n",rv);
			}

			if ((template_get[0].ulValueLen != sizeof(cert)) || memcmp(template_get[0].pValue, cert, sizeof(cert)))
			{
				printf("Certificate Value Error, cert%d, count%d.\n", i, k);
			}
			else
			{
				printf("Certificate Value OK, cert%d, count%d\n", i, k);
			}

			for(j=0; j<sizeof(template_get)/sizeof(template_get[0]); j++)
			{
				free(template_get[j].pValue);
				template_get[j].pValue = NULL;
			}
		}
	}
	

	for (i=0; i<ulObjectCount; i++)
	{
		rv = pC_DestroyObject(hSession, hObject[i]);
		if(rv!=CKR_OK)
		{
			printf("test_object_cert failed,pC_DestroyObject. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}
	}

	bRtn = true;
END:
	printf("leave test_object_cert.\n");
	return bRtn;
}

bool test_object_data_d_c_r_d()
{
	bool	bRtn = false;

	CK_BBOOL ttrue = CK_TRUE;
	CK_BBOOL ffalse = CK_FALSE;

	CK_RV	rv = 0;
	CK_OBJECT_HANDLE hCertificate = NULL_PTR;

	CK_OBJECT_HANDLE hObject[16] = {0};
	CK_ULONG i = 0, j = 0, k = 0, ulObjectCount = 0, ulReadTime = 1;
	UtilscTime ttc1={0, 0},ttc2={0,0},ttc3={0,0},ttc4={0,0},ttc5={0,0};

	printf("enter test_object_cert.\n");

	CK_BYTE cert[1024]={0x30,0x82,0x05,0x6D,0x30,0x82,0x04,0x55,0xA0,0x03,0x02,0x01,0x02,0x02,0x0A,0x22,
		0x09,0x63,0xB1,0x00,0x00,0x00,0x00,0x64,0x45,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,
		0x86,0xF7,0x0D,0x01,0x01,0x05,0x05,0x00,0x30,0x3E,0x31,0x13,0x30,0x11,0x06,0x0A,
		0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,0x03,0x63,0x6F,0x6D,0x31,
		0x18,0x30,0x16,0x06,0x0A,0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,
		0x08,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x31,0x0D,0x30,0x0B,0x06,0x03,0x55,
		0x04,0x03,0x13,0x04,0x42,0x4A,0x49,0x53,0x30,0x1E,0x17,0x0D,0x31,0x33,0x30,0x36,
		0x30,0x34,0x30,0x35,0x34,0x38,0x32,0x33,0x5A,0x17,0x0D,0x31,0x34,0x30,0x36,0x30,
		0x34,0x30,0x35,0x34,0x38,0x32,0x33,0x5A,0x30,0x58,0x31,0x13,0x30,0x11,0x06,0x0A,
		0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,0x03,0x63,0x6F,0x6D,0x31,
		0x18,0x30,0x16,0x06,0x0A,0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,
		0x08,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x31,0x18,0x30,0x16,0x06,0x03,0x55,
		0x04,0x0B,0x0C,0x0F,0x44,0x65,0x70,0x61,0x72,0x74,0x5F,0x69,0x6E,0x66,0x6F,0x74,
		0x65,0x63,0x68,0x31,0x0D,0x30,0x0B,0x06,0x03,0x55,0x04,0x03,0x13,0x04,0x74,0x65,
		0x73,0x74,0x30,0x81,0x9F,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,
		0x01,0x01,0x05,0x00,0x03,0x81,0x8D,0x00,0x30,0x81,0x89,0x02,0x81,0x81,0x00,0xBC,
		0x13,0x01,0xAE,0xF2,0x5F,0x39,0x5A,0xF2,0xB2,0x95,0xC3,0xD1,0x04,0x64,0x60,0x09,
		0xAA,0xAB,0x8B,0xA2,0x8F,0x00,0x4A,0x94,0x71,0x93,0xD9,0xD9,0xCA,0x39,0xAA,0xE9,
		0x6E,0xED,0xAE,0xA9,0x87,0x29,0x22,0xB3,0x52,0x40,0x2B,0xDE,0xC3,0x6F,0x0D,0x8B,
		0xDD,0x74,0x89,0xE0,0x82,0xD1,0xDB,0x7F,0x8E,0xD0,0x8E,0x66,0x5A,0x2C,0x80,0x2C,
		0xCF,0xEB,0x31,0x77,0x54,0xC8,0x16,0xBA,0xE9,0x76,0x56,0x89,0x52,0xA1,0x09,0xA3,
		0xBA,0xC7,0x0E,0x3F,0xF9,0xBE,0x7C,0x1A,0xA7,0x3B,0xC0,0xFF,0x60,0x40,0x1A,0xCE,
		0xA0,0x1A,0xF1,0xD6,0x33,0xF2,0xBD,0xB3,0x0F,0x30,0x39,0x1D,0x25,0xC2,0xDF,0xA5,
		0x58,0xE7,0xD4,0x69,0x79,0xAC,0x3B,0x0D,0xDF,0x1C,0xAD,0xC1,0x9E,0xA3,0x6D,0x02,
		0x03,0x01,0x00,0x01,0xA3,0x82,0x02};
	CK_OBJECT_CLASS certclass = CKO_CERTIFICATE;
	CK_CERTIFICATE_TYPE certtype = CKC_X_509;
	CK_BYTE subject[] = {'s','u','b','j','e','c','t'};
	CK_BYTE issuer[] = {'i','s','s','u','e','r'};
	CK_BYTE SN[] = {'1','2','3','4','5','6'};

	CK_ATTRIBUTE_TYPE cko_class = CKO_DATA;

	CK_ATTRIBUTE dataTemplate[] = {
	{ CKA_APPLICATION, subject, sizeof(subject) },
	{ CKA_LABEL, issuer, sizeof(issuer)},
	{ CKA_VALUE, cert, sizeof(cert) },
	{ CKA_CLASS, &cko_class, sizeof(CK_ATTRIBUTE_TYPE)},
	{ CKA_TOKEN, &ttrue, sizeof(CK_BBOOL) },
	{ CKA_PRIVATE, &ttrue, sizeof(CK_BBOOL) } 
	};

	CK_ATTRIBUTE certTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &certclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_CERTIFICATE_TYPE, &certtype, sizeof(CK_CERTIFICATE_TYPE)},
		{CKA_VALUE, cert, sizeof(cert)},
		{CKA_LABEL, issuer, sizeof(issuer)}
		//{CKA_LOCATION_ATTRIBUTES, }
	};



	CK_ATTRIBUTE certfindtemplate[] = {
		{CKA_APPLICATION, subject, sizeof(subject)}
	};

	CK_ATTRIBUTE template_get[] = {
		{CKA_VALUE, NULL, 0}
	};

	////查找证书对象
	//rv = pC_FindObjectsInit(hSession, certfindtemplate, sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE));
	//if(rv!=CKR_OK)
	//{
	//	printf("test_object_cert failed,pC_FindObjectsInit1. rv=0x%08x. i=%d.\n",rv,i);
	//	goto END;
	//}


	//ulObjectCount = sizeof(hObject) / sizeof(CK_OBJECT_HANDLE);
	//printf("ulObjectCount11111=%d\n",ulObjectCount);
	//rv = pC_FindObjects(hSession, hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
	//printf("ulObjectCount22222=%d\n",ulObjectCount);
	//if(rv!=CKR_OK)
	//{
	//	printf("test_object_cert failed,pC_FindObjects2. rv=0x%08x. i=%d.\n",rv,i);
	//	goto END;
	//}


	//rv = pC_FindObjectsFinal(hSession);
	//if(rv!=CKR_OK)
	//{
	//	printf("test_object_cert failed,pC_FindObjectsFinal2. rv=0x%08x. i=%d.\n",rv,i);
	//	goto END;
	//}

	//printf(" C_FindObjects count %d.\n",ulObjectCount);



	//for (i=0; i<ulObjectCount; i++)
	//{
	//	printf("Cert i=%d,CertObject=0x%08x.\n",i,hObject[i]);
	//	//nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"Cert i=%d,CertObject=0x%08x.\n",i,hObjectDestory);

	//	rv = (*pC_DestroyObject)(hSession, hObject[i]);
	//	if(rv!=CKR_OK)
	//	{
	//		printf("test_FindCertObjectNumberfailed, pC_DestroyCertObject. rv=0x%08x.\n",rv);
	//		//nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"test_FindCertObjectNumberfailed, pC_DestroyCertObject. rv=0x%08x.\n",rv);	
	//		return false;

	//	}
	//	else
	//	{
	//		printf("Destroy Cert=0x%08x Success.\n",hObject[i]);
	//		//nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"Destroy KeyObject=0x%08x Success.\n",hObjectDestory);	

	//	}
	//}

	////查找证书对象
	//rv = pC_FindObjectsInit(hSession, certfindtemplate, sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE));
	//if(rv!=CKR_OK)
	//{
	//	printf("test_object_cert failed,pC_FindObjectsInit. rv=0x%08x. i=%d.\n",rv,i);
	//	goto END;
	//}

	//ulObjectCount = sizeof(hObject) / sizeof(CK_OBJECT_HANDLE);
	//printf("ulObjectCount11111=%d\n",ulObjectCount);
	//rv = pC_FindObjects(hSession, hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
	//printf("ulObjectCount22222=%d\n",ulObjectCount);
	//if(rv!=CKR_OK)
	//{
	//	printf("test_object_cert failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
	//	goto END;
	//}

	//rv = pC_FindObjectsFinal(hSession);
	//if(rv!=CKR_OK)
	//{
	//	printf("test_object_cert failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
	//	goto END;
	//}

	//if(ulObjectCount != 0)
	//{
	//	printf(" Error:C_FindObjects count should 0, ulObjectCount = %d.\n",ulObjectCount);
	//}


	//创建证书对象
	Utilsgettime(&ttc1);
	rv = (*pC_CreateObject)(hSession, 
		dataTemplate, sizeof(dataTemplate)/sizeof(CK_ATTRIBUTE),
		&hCertificate);

	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_CreateObject1. rv=0x%08x.\n",rv);
		goto END;
	}
	else
	{
		printf("pC_CreateObject1 Sucecss.\n");
	}
	//
	//rv = (*pC_CreateObject)(hSession, 
	//	certTemplate, sizeof(certTemplate)/sizeof(CK_ATTRIBUTE),
	//	&hCertificate);

	//if(rv!=CKR_OK)
	//{
	//	printf("test_object_cert failed,pC_CreateObject2. rv=0x%08x.\n",rv);
	//	goto END;
	//}
	//else
	//{
	//	printf("pC_CreateObject2 Sucecss.\n");
	//}

	rv = (*pC_CreateObject)(hSession, 
		dataTemplate, sizeof(dataTemplate)/sizeof(CK_ATTRIBUTE),
		&hCertificate);

	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_CreateObject3. rv=0x%08x.\n",rv);
		goto END;
	}
	else
	{
		printf("pC_CreateObject3 Sucecss.\n");
	}
	
	rv = (*pC_CreateObject)(hSession, 
		dataTemplate, sizeof(dataTemplate)/sizeof(CK_ATTRIBUTE),
		&hCertificate);

	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_CreateObject3. rv=0x%08x.\n",rv);
		goto END;
	}
	else
	{
		printf("pC_CreateObject4 Sucecss.\n");
	}
	
	
		Utilsgettime(&ttc2);
		UtilsTimeSubstracted(&ttc2,&ttc1);
		UtilsTimeAdded(&ttc3,&ttc2);
	    Utilsprint(&ttc3,".......Createobject", 1);




	///////////////////////////////////////////////////
	//查找证书对象
	rv = pC_FindObjectsInit(hSession, certfindtemplate, sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE));
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsInit. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	ulObjectCount = sizeof(hObject) / sizeof(CK_OBJECT_HANDLE);
	rv = pC_FindObjects(hSession, hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}


	rv = pC_FindObjectsFinal(hSession);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	printf(" C_FindObjects count %d.\n",ulObjectCount);
	////////////////////////////////////////////////////////////


	//for (k=0; k<ulReadTime; k++)
	//{
	//	printf("kkkkkkkkkkkkkkkkkkkkkkk=%d\n",k);

	//	Utilsgettime(&ttc1);
	//	//查找证书对象
	//	rv = pC_FindObjectsInit(hSession, certfindtemplate, sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE));
	//	if(rv!=CKR_OK)
	//	{
	//		printf("test_object_cert failed,pC_FindObjectsInit. rv=0x%08x. i=%d.\n",rv,i);
	//		goto END;
	//	}

	//	Utilsgettime(&ttc2);
	//	UtilsTimeSubstracted(&ttc2,&ttc1);
	//	UtilsTimeAdded(&ttc3,&ttc2);

	//	Utilsgettime(&ttc1);
	//	ulObjectCount = sizeof(hObject) / sizeof(CK_OBJECT_HANDLE);
	//	//printf("ulObjectCount11111=%d\n",ulObjectCount);
	//	rv = pC_FindObjects(hSession, hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
	//	//printf("ulObjectCount22222=%d\n",ulObjectCount);
	//	if((rv!=CKR_OK) || (ulObjectCount==0))
	//	{
	//		printf("test_object_cert failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
	//		goto END;
	//	}

	//	Utilsgettime(&ttc2);
	//	UtilsTimeSubstracted(&ttc2,&ttc1);
	//	UtilsTimeAdded(&ttc4,&ttc2);

	//	Utilsgettime(&ttc1);
	//	rv = pC_FindObjectsFinal(hSession);
	//	if(rv!=CKR_OK)
	//	{
	//		printf("test_object_cert failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
	//		goto END;
	//	}
	//	Utilsgettime(&ttc2);
	//	UtilsTimeSubstracted(&ttc2,&ttc1);
	//	UtilsTimeAdded(&ttc5,&ttc2);

	//	printf(" C_FindObjects count %d.\n",ulObjectCount);

	//	//获取证书的值
	//	for (i=0; i<ulObjectCount; i++)
	//	{
	//		rv=pC_GetAttributeValue(hSession, hObject[i], template_get, sizeof(template_get)/sizeof(template_get[0]));
	//		if(rv!=CKR_OK)
	//		{
	//			printf("test_object_cert failed,pC_GetAttributeValue failed. rv=0x%x.\n",rv);
	//			goto END;
	//		}

	//		for(j=0; j<sizeof(template_get)/sizeof(template_get[0]); j++)
	//		{
	//			template_get[j].pValue=(CK_VOID_PTR)malloc(template_get[j].ulValueLen);
	//			if(template_get[j].pValue==NULL)
	//			{
	//				printf(" pC_GetAttributeValue memory out.\n");
	//			}
	//			memset(template_get[j].pValue, 0, template_get[j].ulValueLen);
	//		}

	//		rv=pC_GetAttributeValue(hSession, hObject[i], template_get,sizeof(template_get)/sizeof(template_get[0]));
	//		if(rv!=CKR_OK)
	//		{
	//			printf(" pC_GetAttributeValue failed 2. rv=0x%x.\n",rv);
	//		}

	//		if ((template_get[0].ulValueLen != sizeof(cert)) || memcmp(template_get[0].pValue, cert, sizeof(cert)))
	//		{
	//			printf("Certificate Value Error, cert%d, count%d.\n", i, k);
	//		}
	//		else
	//		{
	//			printf("Certificate Value OK, cert%d, count%d\n", i, k);
	//		}

	//		for(j=0; j<sizeof(template_get)/sizeof(template_get[0]); j++)
	//		{
	//			free(template_get[j].pValue);
	//			template_get[j].pValue = NULL;
	//		}
	//	}
	//}

	//Utilsprint(&ttc3,"ZUC Encrypt", ulReadTime);
	//Utilsprint(&ttc4,"ZUC Encrypt", ulReadTime);
	//Utilsprint(&ttc5,"ZUC Encrypt", ulReadTime);

	//for (i=0; i<ulObjectCount; i++)
	//{
	//	rv = pC_DestroyObject(hSession, hObject[i]);
	//	if(rv!=CKR_OK)
	//	{
	//		printf("test_object_cert failed,pC_DestroyObject. rv=0x%08x. i=%d.\n",rv,i);
	//		return FALSE;
	//	}
	//}

	bRtn = true;
END:
	printf("leave test_object_cert.\n");

	return bRtn;
}

bool test_object_cert_d_c_r_d()
{
	bool	bRtn = false;

	CK_BBOOL ttrue = CK_TRUE;
	CK_BBOOL ffalse = CK_FALSE;

	CK_RV	rv = 0;
	CK_OBJECT_HANDLE hCertificate = NULL_PTR;

	CK_OBJECT_HANDLE hObject[16] = {0};
	CK_ULONG i = 0, j = 0, k = 0, ulObjectCount = 0, ulReadTime = 1;

	printf("enter test_object_cert.\n");

	//有效证书的value
	CK_BYTE cert[1393]={0x30,0x82,0x05,0x6D,0x30,0x82,0x04,0x55,0xA0,0x03,0x02,0x01,0x02,0x02,0x0A,0x22,
		0x09,0x63,0xB1,0x00,0x00,0x00,0x00,0x64,0x45,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,
		0x86,0xF7,0x0D,0x01,0x01,0x05,0x05,0x00,0x30,0x3E,0x31,0x13,0x30,0x11,0x06,0x0A,
		0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,0x03,0x63,0x6F,0x6D,0x31,
		0x18,0x30,0x16,0x06,0x0A,0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,
		0x08,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x31,0x0D,0x30,0x0B,0x06,0x03,0x55,
		0x04,0x03,0x13,0x04,0x42,0x4A,0x49,0x53,0x30,0x1E,0x17,0x0D,0x31,0x33,0x30,0x36,
		0x30,0x34,0x30,0x35,0x34,0x38,0x32,0x33,0x5A,0x17,0x0D,0x31,0x34,0x30,0x36,0x30,
		0x34,0x30,0x35,0x34,0x38,0x32,0x33,0x5A,0x30,0x58,0x31,0x13,0x30,0x11,0x06,0x0A,
		0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,0x03,0x63,0x6F,0x6D,0x31,
		0x18,0x30,0x16,0x06,0x0A,0x09,0x92,0x26,0x89,0x93,0xF2,0x2C,0x64,0x01,0x19,0x16,
		0x08,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x31,0x18,0x30,0x16,0x06,0x03,0x55,
		0x04,0x0B,0x0C,0x0F,0x44,0x65,0x70,0x61,0x72,0x74,0x5F,0x69,0x6E,0x66,0x6F,0x74,
		0x65,0x63,0x68,0x31,0x0D,0x30,0x0B,0x06,0x03,0x55,0x04,0x03,0x13,0x04,0x74,0x65,
		0x73,0x74,0x30,0x81,0x9F,0x30,0x0D,0x06,0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,
		0x01,0x01,0x05,0x00,0x03,0x81,0x8D,0x00,0x30,0x81,0x89,0x02,0x81,0x81,0x00,0xBC,
		0x13,0x01,0xAE,0xF2,0x5F,0x39,0x5A,0xF2,0xB2,0x95,0xC3,0xD1,0x04,0x64,0x60,0x09,
		0xAA,0xAB,0x8B,0xA2,0x8F,0x00,0x4A,0x94,0x71,0x93,0xD9,0xD9,0xCA,0x39,0xAA,0xE9,
		0x6E,0xED,0xAE,0xA9,0x87,0x29,0x22,0xB3,0x52,0x40,0x2B,0xDE,0xC3,0x6F,0x0D,0x8B,
		0xDD,0x74,0x89,0xE0,0x82,0xD1,0xDB,0x7F,0x8E,0xD0,0x8E,0x66,0x5A,0x2C,0x80,0x2C,
		0xCF,0xEB,0x31,0x77,0x54,0xC8,0x16,0xBA,0xE9,0x76,0x56,0x89,0x52,0xA1,0x09,0xA3,
		0xBA,0xC7,0x0E,0x3F,0xF9,0xBE,0x7C,0x1A,0xA7,0x3B,0xC0,0xFF,0x60,0x40,0x1A,0xCE,
		0xA0,0x1A,0xF1,0xD6,0x33,0xF2,0xBD,0xB3,0x0F,0x30,0x39,0x1D,0x25,0xC2,0xDF,0xA5,
		0x58,0xE7,0xD4,0x69,0x79,0xAC,0x3B,0x0D,0xDF,0x1C,0xAD,0xC1,0x9E,0xA3,0x6D,0x02,
		0x03,0x01,0x00,0x01,0xA3,0x82,0x02,0xD5,0x30,0x82,0x02,0xD1,0x30,0x0B,0x06,0x03,
		0x55,0x1D,0x0F,0x04,0x04,0x03,0x02,0x05,0xA0,0x30,0x1D,0x06,0x03,0x55,0x1D,0x0E,
		0x04,0x16,0x04,0x14,0x39,0x6B,0x69,0x14,0x6F,0x73,0x4B,0x5B,0xC9,0xDE,0x86,0x9D,
		0xC1,0x25,0xF8,0x12,0x5B,0x4A,0x34,0x8F,0x30,0x2B,0x06,0x09,0x2B,0x06,0x01,0x04,
		0x01,0x82,0x37,0x14,0x02,0x04,0x1E,0x1E,0x1C,0x00,0x53,0x00,0x6D,0x00,0x61,0x00,
		0x72,0x00,0x74,0x00,0x63,0x00,0x61,0x00,0x72,0x00,0x64,0x00,0x4C,0x00,0x6F,0x00,
		0x67,0x00,0x6F,0x00,0x6E,0x30,0x1F,0x06,0x03,0x55,0x1D,0x23,0x04,0x18,0x30,0x16,
		0x80,0x14,0xC8,0x7A,0xC5,0x17,0x08,0x7F,0x56,0x4D,0x5A,0x45,0xBE,0x6B,0x71,0x09,
		0xD0,0x05,0xDE,0x6F,0x5B,0x04,0x30,0x81,0xF6,0x06,0x03,0x55,0x1D,0x1F,0x04,0x81,
		0xEE,0x30,0x81,0xEB,0x30,0x81,0xE8,0xA0,0x81,0xE5,0xA0,0x81,0xE2,0x86,0x81,0xAD,
		0x6C,0x64,0x61,0x70,0x3A,0x2F,0x2F,0x2F,0x43,0x4E,0x3D,0x42,0x4A,0x49,0x53,0x2C,
		0x43,0x4E,0x3D,0x53,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2C,0x43,0x4E,0x3D,0x43,
		0x44,0x50,0x2C,0x43,0x4E,0x3D,0x50,0x75,0x62,0x6C,0x69,0x63,0x25,0x32,0x30,0x4B,
		0x65,0x79,0x25,0x32,0x30,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,
		0x3D,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,0x3D,0x43,0x6F,0x6E,
		0x66,0x69,0x67,0x75,0x72,0x61,0x74,0x69,0x6F,0x6E,0x2C,0x44,0x43,0x3D,0x4D,0x69,
		0x63,0x72,0x6F,0x53,0x65,0x63,0x2C,0x44,0x43,0x3D,0x63,0x6F,0x6D,0x3F,0x63,0x65,
		0x72,0x74,0x69,0x66,0x69,0x63,0x61,0x74,0x65,0x52,0x65,0x76,0x6F,0x63,0x61,0x74,
		0x69,0x6F,0x6E,0x4C,0x69,0x73,0x74,0x3F,0x62,0x61,0x73,0x65,0x3F,0x6F,0x62,0x6A,
		0x65,0x63,0x74,0x43,0x6C,0x61,0x73,0x73,0x3D,0x63,0x52,0x4C,0x44,0x69,0x73,0x74,
		0x72,0x69,0x62,0x75,0x74,0x69,0x6F,0x6E,0x50,0x6F,0x69,0x6E,0x74,0x86,0x30,0x68,
		0x74,0x74,0x70,0x3A,0x2F,0x2F,0x73,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x6D,
		0x69,0x63,0x72,0x6F,0x73,0x65,0x63,0x2E,0x63,0x6F,0x6D,0x2F,0x43,0x65,0x72,0x74,
		0x45,0x6E,0x72,0x6F,0x6C,0x6C,0x2F,0x42,0x4A,0x49,0x53,0x2E,0x63,0x72,0x6C,0x30,
		0x82,0x01,0x0B,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,0x07,0x01,0x01,0x04,0x81,0xFE,
		0x30,0x81,0xFB,0x30,0x81,0xA4,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,0x07,0x30,0x02,
		0x86,0x81,0x97,0x6C,0x64,0x61,0x70,0x3A,0x2F,0x2F,0x2F,0x43,0x4E,0x3D,0x42,0x4A,
		0x49,0x53,0x2C,0x43,0x4E,0x3D,0x41,0x49,0x41,0x2C,0x43,0x4E,0x3D,0x50,0x75,0x62,
		0x6C,0x69,0x63,0x25,0x32,0x30,0x4B,0x65,0x79,0x25,0x32,0x30,0x53,0x65,0x72,0x76,
		0x69,0x63,0x65,0x73,0x2C,0x43,0x4E,0x3D,0x53,0x65,0x72,0x76,0x69,0x63,0x65,0x73,
		0x2C,0x43,0x4E,0x3D,0x43,0x6F,0x6E,0x66,0x69,0x67,0x75,0x72,0x61,0x74,0x69,0x6F,
		0x6E,0x2C,0x44,0x43,0x3D,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x2C,0x44,0x43,
		0x3D,0x63,0x6F,0x6D,0x3F,0x63,0x41,0x43,0x65,0x72,0x74,0x69,0x66,0x69,0x63,0x61,
		0x74,0x65,0x3F,0x62,0x61,0x73,0x65,0x3F,0x6F,0x62,0x6A,0x65,0x63,0x74,0x43,0x6C,
		0x61,0x73,0x73,0x3D,0x63,0x65,0x72,0x74,0x69,0x66,0x69,0x63,0x61,0x74,0x69,0x6F,
		0x6E,0x41,0x75,0x74,0x68,0x6F,0x72,0x69,0x74,0x79,0x30,0x52,0x06,0x08,0x2B,0x06,
		0x01,0x05,0x05,0x07,0x30,0x02,0x86,0x46,0x68,0x74,0x74,0x70,0x3A,0x2F,0x2F,0x73,
		0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x6D,0x69,0x63,0x72,0x6F,0x73,0x65,0x63,
		0x2E,0x63,0x6F,0x6D,0x2F,0x43,0x65,0x72,0x74,0x45,0x6E,0x72,0x6F,0x6C,0x6C,0x2F,
		0x53,0x65,0x72,0x76,0x65,0x72,0x30,0x32,0x2E,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,
		0x63,0x2E,0x63,0x6F,0x6D,0x5F,0x42,0x4A,0x49,0x53,0x2E,0x63,0x72,0x74,0x30,0x1F,
		0x06,0x03,0x55,0x1D,0x25,0x04,0x18,0x30,0x16,0x06,0x08,0x2B,0x06,0x01,0x05,0x05,
		0x07,0x03,0x02,0x06,0x0A,0x2B,0x06,0x01,0x04,0x01,0x82,0x37,0x14,0x02,0x02,0x30,
		0x2C,0x06,0x03,0x55,0x1D,0x11,0x04,0x25,0x30,0x23,0xA0,0x21,0x06,0x0A,0x2B,0x06,
		0x01,0x04,0x01,0x82,0x37,0x14,0x02,0x03,0xA0,0x13,0x0C,0x11,0x74,0x65,0x73,0x74,
		0x40,0x4D,0x69,0x63,0x72,0x6F,0x53,0x65,0x63,0x2E,0x63,0x6F,0x6D,0x30,0x0D,0x06,
		0x09,0x2A,0x86,0x48,0x86,0xF7,0x0D,0x01,0x01,0x05,0x05,0x00,0x03,0x82,0x01,0x01,
		0x00,0x79,0x84,0x2F,0x6E,0x39,0x9C,0x0A,0xC8,0xDE,0x9E,0x2B,0xEA,0x5D,0xD4,0x88,
		0x04,0x98,0xFA,0x60,0x90,0x9E,0xEA,0xBC,0xBE,0x95,0xAB,0x3E,0xA8,0x52,0xF6,0x96,
		0x65,0x7B,0x1A,0x5A,0x46,0x0D,0x3A,0x12,0xE1,0x4F,0x8F,0xF8,0xDE,0xB6,0x5F,0x88,
		0xBF,0xDB,0xEF,0x08,0x11,0x16,0x9E,0xCA,0x35,0x4A,0xE6,0x76,0xA9,0x87,0xD5,0x5B,
		0x3D,0x7D,0x8F,0x9B,0x14,0xA4,0x69,0x6F,0x1F,0xEC,0xB7,0x36,0x8D,0xD2,0x04,0xF4,
		0x0D,0x70,0x4E,0xE8,0xF0,0xF2,0xDA,0x4E,0x8C,0x8F,0x12,0xF5,0x29,0x4A,0xC1,0x25,
		0x26,0x3E,0x7A,0x26,0x5E,0x78,0x6B,0x5D,0xED,0x14,0x57,0xDA,0x01,0xC7,0x36,0xCD,
		0xD1,0xA9,0xC9,0x53,0x4F,0xB2,0xDD,0xB1,0xB0,0x11,0x05,0x57,0xFA,0x75,0x7C,0x24,
		0x81,0xD1,0xEF,0xE2,0x1D,0x5B,0x59,0x9B,0x4C,0x14,0x6C,0x4E,0x6D,0xEF,0xDB,0x20,
		0x75,0x7A,0x96,0x81,0x46,0xA6,0x13,0xC5,0xD5,0x69,0x45,0x32,0xE7,0x3F,0x24,0x48,
		0x6A,0xCF,0xA5,0x5A,0x20,0x8C,0x43,0xF3,0xDB,0x66,0x6E,0x45,0x2B,0x5D,0x3A,0x5C,
		0x4E,0xA5,0x5F,0x09,0x70,0xBF,0xF5,0x6A,0x3A,0xA9,0xCA,0x4C,0x2D,0x93,0x3C,0x6C,
		0xB3,0xFA,0xA4,0x2F,0x8F,0x75,0x97,0xD2,0x85,0xF4,0x51,0x18,0x38,0x48,0xE7,0xEA,
		0x89,0x66,0x55,0x26,0x28,0x30,0x7F,0xA4,0x3F,0xE9,0xC7,0x99,0xAA,0x41,0x2B,0xEC,
		0x2B,0x17,0x3B,0x33,0x1E,0xCA,0xFD,0xF5,0x19,0xD4,0xF3,0xBD,0x7F,0xEE,0x65,0x03,
		0xB7,0xDD,0xBC,0x95,0x2D,0xDA,0x58,0x95,0x99,0x25,0x84,0xEC,0xC5,0xE0,0xE6,0x29,
		0x7E};
	CK_OBJECT_CLASS certclass = CKO_CERTIFICATE;
	CK_CERTIFICATE_TYPE certtype = CKC_X_509;
	CK_BYTE subject[] = {'s','u','b','j','e','c','t'};
	CK_BYTE issuer[] = {'i','s','s','u','e','r'};
	CK_BYTE SN[] = {'1','2','3','4','5','6'};


	CK_ATTRIBUTE certTemplate[] = {
		{CKA_TOKEN, &ttrue, sizeof(ttrue)},
		{CKA_CLASS, &certclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_CERTIFICATE_TYPE, &certtype, sizeof(CK_CERTIFICATE_TYPE)},
		{CKA_SUBJECT, subject, sizeof(subject)},
		{CKA_ISSUER,  issuer, sizeof(issuer)},
		{CKA_SERIAL_NUMBER, SN, sizeof(SN)},
		{CKA_VALUE, cert, sizeof(cert)}
	};

	CK_ATTRIBUTE certfindtemplate[] = {
		{CKA_CLASS, &certclass, sizeof(CK_OBJECT_CLASS)},
		{CKA_SUBJECT, subject, sizeof(subject)}

	};

	CK_ATTRIBUTE template_get[] = {
		{CKA_VALUE, NULL, 0}
	};



	
	//查找证书对象
	rv = pC_FindObjectsInit(hSession, certfindtemplate, sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE));
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsInit. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	ulObjectCount = sizeof(hObject) / sizeof(CK_OBJECT_HANDLE);
	rv = pC_FindObjects(hSession, hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	rv = pC_FindObjectsFinal(hSession);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}


	printf(" C_FindObjects count %d.\n",ulObjectCount);



	for (i=0; i<ulObjectCount; i++)
	{
		printf("Cert i=%d,CertObject=0x%08x.\n",i,hObject[i]);
		//nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"Cert i=%d,CertObject=0x%08x.\n",i,hObjectDestory);

		rv = (*pC_DestroyObject)(hSession, hObject[i]);
		if(rv!=CKR_OK)
		{
			printf("test_FindCertObjectNumberfailed, pC_DestroyCertObject. rv=0x%08x.\n",rv);
			//nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"test_FindCertObjectNumberfailed, pC_DestroyCertObject. rv=0x%08x.\n",rv);	
			return false;

		}
		else
		{
			printf("Destroy Cert=0x%08x Success.\n",hObject[i]);
			//nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"Destroy KeyObject=0x%08x Success.\n",hObjectDestory);	

		}
	}



		//查找证书对象
	rv = pC_FindObjectsInit(hSession, certfindtemplate, sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE));
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsInit. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	ulObjectCount = sizeof(hObject) / sizeof(CK_OBJECT_HANDLE);
	rv = pC_FindObjects(hSession, hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	rv = pC_FindObjectsFinal(hSession);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
		goto END;
	}

	if(ulObjectCount != 0)
	{
		printf(" Error:C_FindObjects count should 0, ulObjectCount = %d.\n",ulObjectCount);
	}

	//创建证书对象
	rv = (*pC_CreateObject)(hSession, 
		certTemplate, sizeof(certTemplate)/sizeof(CK_ATTRIBUTE),
		&hCertificate);
	if(rv!=CKR_OK)
	{
		printf("test_object_cert failed,pC_CreateObject. rv=0x%08x.\n",rv);
		goto END;
	}


	for (k=0; k<ulReadTime; k++)
	{
	
		//查找证书对象
		rv = pC_FindObjectsInit(hSession, certfindtemplate, sizeof(certfindtemplate)/sizeof(CK_ATTRIBUTE));
		if(rv!=CKR_OK)
		{
			printf("test_object_cert failed,pC_FindObjectsInit. rv=0x%08x. i=%d.\n",rv,i);
			goto END;
		}

		ulObjectCount = sizeof(hObject) / sizeof(CK_OBJECT_HANDLE);
		rv = pC_FindObjects(hSession, hObject, sizeof(hObject)/sizeof(CK_OBJECT_HANDLE), &ulObjectCount);
		if((rv!=CKR_OK) || (ulObjectCount==0))
		{
			printf("test_object_cert failed,pC_FindObjects. rv=0x%08x. i=%d.\n",rv,i);
			goto END;
		}

		rv = pC_FindObjectsFinal(hSession);
		if(rv!=CKR_OK)
		{
			printf("test_object_cert failed,pC_FindObjectsFinal. rv=0x%08x. i=%d.\n",rv,i);
			goto END;
		}




		printf(" C_FindObjects count %d.\n",ulObjectCount);

		//获取证书的值
		for (i=0; i<ulObjectCount; i++)
		{
			rv=pC_GetAttributeValue(hSession, hObject[i], template_get, sizeof(template_get)/sizeof(template_get[0]));
			if(rv!=CKR_OK)
			{
				printf("test_object_cert failed,pC_GetAttributeValue failed. rv=0x%x.\n",rv);
				goto END;
			}

			for(j=0; j<sizeof(template_get)/sizeof(template_get[0]); j++)
			{
				template_get[j].pValue=(CK_VOID_PTR)malloc(template_get[j].ulValueLen);
				if(template_get[j].pValue==NULL)
				{
					printf(" pC_GetAttributeValue memory out.\n");
				}
				memset(template_get[j].pValue, 0, template_get[j].ulValueLen);
			}

			rv=pC_GetAttributeValue(hSession, hObject[i], template_get,sizeof(template_get)/sizeof(template_get[0]));
			if(rv!=CKR_OK)
			{
				printf(" pC_GetAttributeValue failed 2. rv=0x%x.\n",rv);
			}

			if ((template_get[0].ulValueLen != sizeof(cert)) || memcmp(template_get[0].pValue, cert, sizeof(cert)))
			{
				printf("Certificate Value Error, cert%d, count%d.\n", i, k);
			}
			else
			{
				printf("Certificate Value OK, cert%d, count%d\n", i, k);
			}

			for(j=0; j<sizeof(template_get)/sizeof(template_get[0]); j++)
			{
				free(template_get[j].pValue);
				template_get[j].pValue = NULL;
			}
		}
	}

	

	for (i=0; i<ulObjectCount; i++)
	{
		rv = pC_DestroyObject(hSession, hObject[i]);
		if(rv!=CKR_OK)
		{
			printf("test_object_cert failed,pC_DestroyObject. rv=0x%08x. i=%d.\n",rv,i);
			return FALSE;
		}
	}

	bRtn = true;
END:
	printf("leave test_object_cert.\n");

	return bRtn;
}


/*测试对称密钥（SM4,由CreateObject导入）在flash中的存储*/
bool test_Flash_SymmetricKey()
{
	
	bool	bRtn = false;
	int nResultLength = 0;
	CK_ULONG ulObjectCount = 0;

	CK_OBJECT_HANDLE hObject[16] = {0};

	CK_BBOOL ttrue = CK_TRUE;
	CK_BBOOL ffalse = CK_FALSE;

	CK_KEY_TYPE SM4keyType = CKK_SM4;
	
	CK_RV	rv = 0;

	CK_OBJECT_HANDLE hBaseKey = NULL_PTR;

	int i = 0;
	int iMaxCount =8;
		
	unsigned char	SM4keyVal_Enc[]={0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02};
	unsigned char	SM4iv_Enc[16] = {0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04};
	
	printf("enter test_flash_object2.\n");


	CK_OBJECT_CLASS keyClass = CKO_SECRET_KEY;


	CK_MECHANISM SM4mechanism_Enc = {CKM_SM4_ECB, SM4iv_Enc, sizeof(SM4iv_Enc)};

	CK_BYTE	nBaseKeyID[9] = {CK_SESSKEY_PRESET_ID0, CK_SESSKEY_PRESET_ID1, CK_SESSKEY_PRESET_ID2,CK_SESSKEY_PRESET_ID3,CK_SESSKEY_PRESET_ID4,CK_SESSKEY_PRESET_ID5,CK_SESSKEY_PRESET_ID6,CK_SESSKEY_PRESET_ID7,CK_SESSKEY_PRESET_ID0};


	//nResultLength += sprintf(Testresult[nItemNumb] + nResultLength,"%s\n","Before create objects 17 times and find objects...");

	for (i = 0; i < iMaxCount + 1; i++)
	{
			
	    //创建对称密钥 SM4
	    CK_ATTRIBUTE SM4keyTemplate_Enc[] = 
			{
				{CKA_CLASS, &keyClass, sizeof(keyClass)},
				{CKA_TOKEN, &ffalse, sizeof(ffalse)},//FLASH ,FFLASE RAM
				{CKA_KEY_TYPE, &SM4keyType, sizeof(CK_KEY_TYPE)},
				{CKA_ENCRYPT, &ttrue, sizeof(ttrue)},
				{CKA_EXTRACTABLE, &ttrue, sizeof(ttrue)},
				{CKA_VALUE,SM4keyVal_Enc,sizeof(SM4keyVal_Enc)},
				{CKA_SESSKEY_ID, &nBaseKeyID[i], sizeof(CK_BYTE)}
			};

		rv = pC_CreateObject(hSession, SM4keyTemplate_Enc, sizeof(SM4keyTemplate_Enc)/sizeof(CK_ATTRIBUTE), &hBaseKey);

		if(rv != CKR_OK)
		{
			printf("C_CreateObject failed,pC_GenerateKey. rv=0x%08x. i=%d.\n", rv, i);
			nResultLength += sprintf(Testresult[nItemNumb] + nResultLength,"C_CreateObject failed,pC_GenerateKey. rv=0x%08x. i=%d.<br>", rv, i) ;
			//return FALSE;
		}
		else
		{
			printf("C_CreateObject, pC_GenerateKey %d ok.\n", i);
			nResultLength += sprintf(Testresult[nItemNumb] + nResultLength,"C_CreateObject, pC_GenerateKey %d ok.<br>", i) ;
		}
	}
	
	bRtn = true;
	

		CK_ATTRIBUTE SM4findkeyTemplate_Enc[] = 
		{
			{CKA_CLASS, &keyClass, sizeof(keyClass)},
			{CKA_TOKEN, &ttrue, sizeof(ttrue)},//FLASH ,FFLASE RAM
			{CKA_KEY_TYPE, &SM4keyType, sizeof(CK_KEY_TYPE)}
			//{CKA_SESSKEY_ID, &nBaseKeyID[i], sizeof(CK_BYTE)}
		};
		rv = (*pC_FindObjectsInit)(hSession, SM4findkeyTemplate_Enc, sizeof(SM4findkeyTemplate_Enc)/sizeof(CK_ATTRIBUTE));

		if(rv != CKR_OK)
		{
			printf("test_FindCertObjectNumber failed,pC_FindObjectsInit,1. rv=0x%08x.\n",rv);
			nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"test_FindCertObjectNumber failed,pC_FindObjectsInit,1. rv=0x%08x.\n", rv);
			return FALSE;
		}
		ulObjectCount = 0;

		rv = (*pC_FindObjects)(hSession, hObject, 16, &ulObjectCount);

		if(rv != CKR_OK)
		{
			printf("test_FindCertObjectNumber failed,pC_FindprvObjects,1. rv=0x%08x.\n", rv);
			nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"test_FindCertObjectNumber failed,pC_FindprvObjects,1. rv=0x%08x.\n", rv);
			return FALSE;
		}
		else
		{
			printf("Private Key count=%d.\n", ulObjectCount);
			nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"SM4 Key count=%d.\n", ulObjectCount);
		}

		rv = (*pC_FindObjectsFinal)(hSession);

		if(rv != CKR_OK)
		{
			printf("test_FindCertObjectNumber failed,pC_FindpObjectsFinal,1. rv=0x%08x.\n",rv);
			nResultLength += sprintf(Testresult[nItemNumb]+nResultLength ,"test_FindCertObjectNumbers failed,pC_FindpObjectsFinal,1. rv=0x%08x.\n",rv);
			return FALSE;
		}


		CK_ATTRIBUTE dataTemplate_get[] = {
			{CKA_SESSKEY_ID, &nBaseKeyID[i] , sizeof(CK_BYTE)},
			{CKA_VALUE, SM4keyVal_Enc, sizeof(SM4keyVal_Enc) }
		};

	printf("leave test_object_max_count.\n");

	return bRtn;

}

